---
title: PCA
jupyter: 
  kernelspec:
    name: "Omic_Integration"
    language: "python"
    display_name: "Omic_Integration"
---

## Resumen
En este informe, se realiza un análisis de Componentes Principales (PCA) sobre el conjunto de datos agregado.

Añadir al sistema al ruta al directorio base para importar módulos personalizados.
```{python}
import sys, os

sys.path.append(os.path.abspath(".."))
```

Importar librerías y módulos necesarios.
```{python}
import pandas as pd
import numpy as np
from sklearn.decomposition import PCA
import matplotlib.pyplot as plt
import src.data_utils as du
```

Definir el directorio de datos procesados y cargar el conjunto de datos agregado.
```{python}
CLR_DATA_DIR = "clr_data/"
M_clr = du.load_data(CLR_DATA_DIR + "M_clr", index_col=0)
```

Estudiar cantidad de componentes necesarias para explicar varianza.
```{python}
N_COMPONENTS = 20
pca = PCA(n_components=N_COMPONENTS)
pca.fit(M_clr)
pca_transformed = pca.transform(M_clr)
pca_dict = dict()
for i in range(N_COMPONENTS):
    pca_dict[i + 1] = pca_transformed[:, : i + 1]
pca_explained_variance = np.cumsum(pca.explained_variance_ratio_)
plt.figure(figsize=(10, 6))
plt.plot(pca_dict.keys(), pca_explained_variance, marker="o")
plt.title("PCA Explained Variance")
plt.xticks(list(pca_dict.keys()))
plt.xlabel("Number of Components")
plt.ylabel("Explained Variance")
plt.grid()
plt.show()
```

Crear un DataFrame con los resultados del PCA y guardar los datos.
```{python}
M_pca_pd = pd.DataFrame(pca_transformed, index=M_clr.index)
M_pca_pd.columns = [f"PCA{i + 1}" for i in range(M_pca_pd.shape[1])]
```

```{python}
PROCESSED_DATA_DIR = "processed_data/"
du.save_data(M_pca_pd, PROCESSED_DATA_DIR + "M_pca")
```

---
