---
title: MOFA & PCA analysis
jupyter: 
  kernelspec:
    name: "Omic_Integration"
    language: "python"
    display_name: "Omic_Integration"
---

## Resumen
En este informe, se realiza un análisis comparativo entre los resultados obtenidos mediante PCA y MOFA. Además, de un análisis de los factores y componentes principales obtenidos incluyendo la metadata asociada.

Añadir al sistema al ruta al directorio base para importar módulos personalizados.
```{python}
import sys, os
sys.path.append(os.path.abspath(".."))
```

Importar librerías y módulos necesarios.
```{python}
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import src.data_utils as du
import src.plots as p
```

Importar datos procesados de PCA y MOFA.
```{python}
DATA_DIR = "../data/"
PROCESSED_DATA_DIR = DATA_DIR + "processed_data/"
MOFA_DATA_DIR = DATA_DIR + "MOFA_dir/"
PROCESSED_METADATA_DIR = DATA_DIR + "processed_metadata/"

# Matriz de componentes de PCA
m_pca = du.load_data(PROCESSED_DATA_DIR + "M_pca", index_col=0)

# Matriz de fatores de MOFA
m_factors = du.load_data(MOFA_DATA_DIR + "M_factors", index_col=0)

# Matriz de varianza explicada
variance_explained = du.load_data(MOFA_DATA_DIR + "M_variance_explained", index_col=0)

# Matrices de pesos de MOFA, por cada una de las vistas
w_biogeochemical_genes = du.load_data(
    MOFA_DATA_DIR + "W_biogeochemical_genes", index_col=0
)
w_metabolic_genes = du.load_data(MOFA_DATA_DIR + "W_metabolic_genes", index_col=0)
w_taxa_order = du.load_data(MOFA_DATA_DIR + "W_taxa_order", index_col=0)
w_taxa_phylum = du.load_data(MOFA_DATA_DIR + "W_taxa_phylum", index_col=0)

# Matriz de metadata agregada
metadata = du.load_data(PROCESSED_METADATA_DIR + "Metadata_aggregated", index_col=0)
```


Análisis visual de PCA
```{python}
pca_1 = m_pca["PCA1"]
pca_2 = m_pca["PCA2"]
pca_3 = m_pca["PCA3"]
p.scatter_plot_3d(
    pca_1,
    pca_2,
    pca_3,
    xlabel="PCA 1",
    ylabel="PCA 2",
    title="PCA 3D Scatter Plot",
    s=40,
)
```

Análisis visual de MOFA
```{python}
mofa_1 = m_factors["Factor_1"]
mofa_2 = m_factors["Factor_2"]
mofa_3 = m_factors["Factor_3"]
p.scatter_plot_3d(
    mofa_1,
    mofa_2,
    mofa_3,
    xlabel="MOFA Factor 1",
    ylabel="MOFA Factor 2",
    title="MOFA 3D Scatter Plot",
    s=40,
)
```

Comparar visualmente PCA y MOFA en sus primeras tres dimensiones.
```{python}
p.doble_scatter_plot_3d(
    mofa_1,
    mofa_2,
    mofa_3,
    pca_1,
    pca_2,
    pca_3,
    xlabel1="MOFA Factor 1",
    ylabel1="MOFA Factor 2",
    xlabel2="PCA 1",
    ylabel2="PCA 2",
    title1="MOFA 3D Scatter Plot",
    title2="PCA 3D Scatter Plot",
    s=20,
)
```

Variance explicada por cada factor y vista en MOFA.
```{python}
p.plot_variance_explained(variance_explained)
```

Caracteristicas más importantes por factor en MOFA.
```{python}
num_factors = 2
num_top_features = 10
top_features_biogeochemical_genes = p.plot_factor_top_features(
    w_biogeochemical_genes, num_factors=num_factors, num_top_features=num_top_features
)
display(top_features_biogeochemical_genes)
```

```{python}
top_features_metabolic_genes = p.plot_factor_top_features(
    w_metabolic_genes, num_factors=num_factors, num_top_features=num_top_features
)
display(top_features_metabolic_genes)
```

```{python}
top_features_taxa_order = p.plot_factor_top_features(
    w_taxa_order, num_factors=num_factors, num_top_features=num_top_features
)
display(top_features_taxa_order)
```

```{python}
top_features_taxa_phylum = p.plot_factor_top_features(
    w_taxa_phylum, num_factors=num_factors, num_top_features=num_top_features
)
display(top_features_taxa_phylum)
```

Análisis de relación entre factores de MOFA y metadata.
```{python}
numerical_columns_metadata = metadata.select_dtypes(
    include=[np.number]
).columns.tolist()
numerical_columns_metadata.remove("day")
numerical_columns_metadata.remove("hour")
numerical_columns_metadata.remove("minute")
numerical_columns_metadata.remove("second")
numerical_columns_metadata.remove("year")
numerical_columns_metadata.remove("month")
columns_metadata = numerical_columns_metadata
p.plot_factor_metadata(mofa_1, mofa_2, metadata, columns_metadata)
```

___
