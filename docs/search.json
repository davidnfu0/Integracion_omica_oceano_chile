[
  {
    "objectID": "reports/prediction_analysis.html",
    "href": "reports/prediction_analysis.html",
    "title": "Metadata prediction Analysis",
    "section": "",
    "text": "Entrenamiento de modelos supervisados para predecir variables de metadata a partir de los factores latentes obtenidos por MOFA. Evaluación del desempeño de los modelos y análisis de características importantes.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.prediction_utils as pred\nimport src.plots as p\n\nImportar datos procesados de MOFA y metadata.\n\nDATA_DIR = \"../data/\"\nm_factors = du.load_data(DATA_DIR + \"MOFA_dir/M_factors\", index_col=0)\nmetadata = du.load_data(DATA_DIR + \"processed_metadata/Metadata_aggregated\", index_col=1)\n\nSeleccionar variable objetivo y hyperparámetros del modelo.\n\nreg_params = {\n    \"n_estimators\": [100, 200],\n    \"max_depth\": [10, 20, None],\n    \"min_samples_leaf\": [1, 2, 4],\n}\n\nclf_params = {\n    \"n_estimators\": [100, 200],\n    \"max_depth\": [10, None],\n    \"criterion\": [\"gini\", \"entropy\"],\n    \"min_samples_split\": [2, 5],\n}\n\ntarget_columns = [\n    \"depth_m\",\n    \"temperature_[c]\",\n    \"oxygen_[ml/l]\",\n    \"oxygen_level\",\n]\nvalid_targets = [c for c in target_columns if c in metadata.columns]\n\n\nfor target in valid_targets:\n    print(f\"=== Analizando: {target} ===\")\n    y = metadata[target]\n    \n    is_numeric = pd.api.types.is_numeric_dtype(y)\n    num_unique = y.nunique()\n    \n    if is_numeric and num_unique &gt; 10:\n        res = pred.tune_metadata_regressor(m_factors, y, param_grid=reg_params)\n        \n        if \"error\" in res:\n            print(f\"Skipping: {res['error']}\")\n            continue\n            \n        print(f\"Mejores Parámetros: {res['best_params']}\")\n        print(f\"R2 (Test): {res['r2']:.3f} | RMSE: {res['rmse']:.3f}\")\n        \n        p.plot_regression_results(res[\"y_test\"], res[\"y_pred\"], target, res[\"r2\"])\n        \n    else:\n        res = pred.tune_metadata_classifier(m_factors, y, param_grid=clf_params)\n        \n        if \"error\" in res:\n            print(f\"Skipping: {res['error']}\")\n            continue\n            \n        print(f\"Mejores Parámetros: {res['best_params']}\")\n        print(f\"Accuracy (Test): {res['accuracy']:.3f}\")\n        \n        p.plot_confusion_matrix(res[\"confusion_matrix\"], res[\"classes\"], f\"CM: {target}\")\n\n    imp = pred.get_factor_importance(res[\"model\"], res[\"feature_names\"])\n    p.plot_factor_importance_bar(imp, target, top_n=5)\n    \n    print(\"\\n\" + \"-\"*60 + \"\\n\")\n\n=== Analizando: depth_m ===\n-&gt; Tuning Regressor for depth_m...\nMejores Parámetros: {'max_depth': 10, 'min_samples_leaf': 1, 'n_estimators': 100}\nR2 (Test): 0.896 | RMSE: 55.296\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------------------------------------\n\n=== Analizando: temperature_[c] ===\n-&gt; Tuning Regressor for temperature_[c]...\nMejores Parámetros: {'max_depth': 20, 'min_samples_leaf': 1, 'n_estimators': 200}\nR2 (Test): 0.789 | RMSE: 1.387\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------------------------------------\n\n=== Analizando: oxygen_[ml/l] ===\n-&gt; Tuning Regressor for oxygen_[ml/l]...\nMejores Parámetros: {'max_depth': 10, 'min_samples_leaf': 2, 'n_estimators': 200}\nR2 (Test): 0.755 | RMSE: 1.016\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------------------------------------\n\n=== Analizando: oxygen_level ===\n-&gt; Tuning Classifier for oxygen_level...\nMejores Parámetros: {'criterion': 'gini', 'max_depth': 10, 'min_samples_split': 2, 'n_estimators': 200}\nAccuracy (Test): 0.894\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------------------------------------\n\n\n\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\nimport src.data_utils as du\nimport pandas as pd\n\n# Cargar datos\nm_factors = du.load_data(\"../data/MOFA_dir/M_factors\", index_col=0)\nmetadata = du.load_data(\"../data/processed_metadata/Metadata_aggregated\", index_col=0)\n\nprint(\"=== MOFA Indices (Primeros 5) ===\")\nprint(m_factors.index[:5].tolist())\n\nprint(\"\\n=== Metadata Indices (Primeros 5) ===\")\nprint(metadata.index[:5].tolist())\n\n# Verificar intersección\ncommon = m_factors.index.intersection(metadata.index)\nprint(f\"\\nTotal Muestras MOFA: {len(m_factors)}\")\nprint(f\"Total Muestras Metadata: {len(metadata)}\")\nprint(f\"Muestras en común (Intersección): {len(common)}\")\n\nif len(common) == 0:\n    print(\"\\n⚠️ ALERTA: No hay coincidencias. Revisa si una columna es el índice real.\")\n\n=== MOFA Indices (Primeros 5) ===\n['S10_Z00', 'S10_Z01', 'S10_Z05', 'S11_Z00', 'S11_Z01']\n\n=== Metadata Indices (Primeros 5) ===\n[0, 1, 2, 3, 4]\n\nTotal Muestras MOFA: 159\nTotal Muestras Metadata: 159\nMuestras en común (Intersección): 0\n\n⚠️ ALERTA: No hay coincidencias. Revisa si una columna es el índice real."
  },
  {
    "objectID": "reports/prediction_analysis.html#resumen",
    "href": "reports/prediction_analysis.html#resumen",
    "title": "Metadata prediction Analysis",
    "section": "",
    "text": "Entrenamiento de modelos supervisados para predecir variables de metadata a partir de los factores latentes obtenidos por MOFA. Evaluación del desempeño de los modelos y análisis de características importantes.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.prediction_utils as pred\nimport src.plots as p\n\nImportar datos procesados de MOFA y metadata.\n\nDATA_DIR = \"../data/\"\nm_factors = du.load_data(DATA_DIR + \"MOFA_dir/M_factors\", index_col=0)\nmetadata = du.load_data(DATA_DIR + \"processed_metadata/Metadata_aggregated\", index_col=1)\n\nSeleccionar variable objetivo y hyperparámetros del modelo.\n\nreg_params = {\n    \"n_estimators\": [100, 200],\n    \"max_depth\": [10, 20, None],\n    \"min_samples_leaf\": [1, 2, 4],\n}\n\nclf_params = {\n    \"n_estimators\": [100, 200],\n    \"max_depth\": [10, None],\n    \"criterion\": [\"gini\", \"entropy\"],\n    \"min_samples_split\": [2, 5],\n}\n\ntarget_columns = [\n    \"depth_m\",\n    \"temperature_[c]\",\n    \"oxygen_[ml/l]\",\n    \"oxygen_level\",\n]\nvalid_targets = [c for c in target_columns if c in metadata.columns]\n\n\nfor target in valid_targets:\n    print(f\"=== Analizando: {target} ===\")\n    y = metadata[target]\n    \n    is_numeric = pd.api.types.is_numeric_dtype(y)\n    num_unique = y.nunique()\n    \n    if is_numeric and num_unique &gt; 10:\n        res = pred.tune_metadata_regressor(m_factors, y, param_grid=reg_params)\n        \n        if \"error\" in res:\n            print(f\"Skipping: {res['error']}\")\n            continue\n            \n        print(f\"Mejores Parámetros: {res['best_params']}\")\n        print(f\"R2 (Test): {res['r2']:.3f} | RMSE: {res['rmse']:.3f}\")\n        \n        p.plot_regression_results(res[\"y_test\"], res[\"y_pred\"], target, res[\"r2\"])\n        \n    else:\n        res = pred.tune_metadata_classifier(m_factors, y, param_grid=clf_params)\n        \n        if \"error\" in res:\n            print(f\"Skipping: {res['error']}\")\n            continue\n            \n        print(f\"Mejores Parámetros: {res['best_params']}\")\n        print(f\"Accuracy (Test): {res['accuracy']:.3f}\")\n        \n        p.plot_confusion_matrix(res[\"confusion_matrix\"], res[\"classes\"], f\"CM: {target}\")\n\n    imp = pred.get_factor_importance(res[\"model\"], res[\"feature_names\"])\n    p.plot_factor_importance_bar(imp, target, top_n=5)\n    \n    print(\"\\n\" + \"-\"*60 + \"\\n\")\n\n=== Analizando: depth_m ===\n-&gt; Tuning Regressor for depth_m...\nMejores Parámetros: {'max_depth': 10, 'min_samples_leaf': 1, 'n_estimators': 100}\nR2 (Test): 0.896 | RMSE: 55.296\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------------------------------------\n\n=== Analizando: temperature_[c] ===\n-&gt; Tuning Regressor for temperature_[c]...\nMejores Parámetros: {'max_depth': 20, 'min_samples_leaf': 1, 'n_estimators': 200}\nR2 (Test): 0.789 | RMSE: 1.387\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------------------------------------\n\n=== Analizando: oxygen_[ml/l] ===\n-&gt; Tuning Regressor for oxygen_[ml/l]...\nMejores Parámetros: {'max_depth': 10, 'min_samples_leaf': 2, 'n_estimators': 200}\nR2 (Test): 0.755 | RMSE: 1.016\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------------------------------------\n\n=== Analizando: oxygen_level ===\n-&gt; Tuning Classifier for oxygen_level...\nMejores Parámetros: {'criterion': 'gini', 'max_depth': 10, 'min_samples_split': 2, 'n_estimators': 200}\nAccuracy (Test): 0.894\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n------------------------------------------------------------\n\n\n\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\nimport src.data_utils as du\nimport pandas as pd\n\n# Cargar datos\nm_factors = du.load_data(\"../data/MOFA_dir/M_factors\", index_col=0)\nmetadata = du.load_data(\"../data/processed_metadata/Metadata_aggregated\", index_col=0)\n\nprint(\"=== MOFA Indices (Primeros 5) ===\")\nprint(m_factors.index[:5].tolist())\n\nprint(\"\\n=== Metadata Indices (Primeros 5) ===\")\nprint(metadata.index[:5].tolist())\n\n# Verificar intersección\ncommon = m_factors.index.intersection(metadata.index)\nprint(f\"\\nTotal Muestras MOFA: {len(m_factors)}\")\nprint(f\"Total Muestras Metadata: {len(metadata)}\")\nprint(f\"Muestras en común (Intersección): {len(common)}\")\n\nif len(common) == 0:\n    print(\"\\n⚠️ ALERTA: No hay coincidencias. Revisa si una columna es el índice real.\")\n\n=== MOFA Indices (Primeros 5) ===\n['S10_Z00', 'S10_Z01', 'S10_Z05', 'S11_Z00', 'S11_Z01']\n\n=== Metadata Indices (Primeros 5) ===\n[0, 1, 2, 3, 4]\n\nTotal Muestras MOFA: 159\nTotal Muestras Metadata: 159\nMuestras en común (Intersección): 0\n\n⚠️ ALERTA: No hay coincidencias. Revisa si una columna es el índice real."
  },
  {
    "objectID": "reports/clustering_analysis.html",
    "href": "reports/clustering_analysis.html",
    "title": "Cluster Interpretation & Analysis",
    "section": "",
    "text": "Análisis de los clusters obtenidos: distribución geográfica, perfiles de metadatos y determinación de características biológicas (Features) determinantes.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.plots as p\nimport warnings\n\nImportar datos procesados de MOFA y resultados de clustering.\n\nselected_clusters = du.load_data(\n    \"clustering_dir/selected_clusters_GMM_Opt\", index_col=0\n)\nmetadata = du.load_data(\"processed_metadata/Metadata_aggregated\", index_col=1)\nm_clr = du.load_data(\"clr_data/M_clr\", index_col=0)\nm_mofa = du.load_data(\"MOFA_dir/M_factors\", index_col=0)\n\nmetadata_mofa = metadata.join(selected_clusters)\nm_mofa_clusters = m_mofa.join(selected_clusters)\n\n\n\n\ndepths = metadata_mofa[\"depth_m\"].unique()\nfor depth in depths:\n    metadata_depth = metadata_mofa[metadata_mofa[\"depth_m\"] == depth]\n    p.plot_geo_clusters(\n        metadata_depth,\n        metadata_depth[\"Cluster\"],\n        lat_col=\"latitude\",\n        lon_col=\"longitude\",\n        title=\"Geographic Distribution of MOFA Clusters at Depth: \" + str(depth) + \" m\",\n        n_clusters=len(metadata_mofa[\"Cluster\"].unique()),\n    )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\np.plot_geo_clusters_3d(\n    metadata_mofa,\n    metadata_mofa[\"Cluster\"],\n    lat_col=\"latitude\",\n    lon_col=\"longitude\",\n    depth_col=\"depth_m\",\n    title=\"3D Geographic Distribution of MOFA Clusters\",\n    n_clusters=len(metadata_mofa[\"Cluster\"].unique()),\n)\n\n\n\n\n\n\n\n\n\n\n\n\nwarnings.filterwarnings(\"ignore\")\n\nenv_vars = [\n  \"depth_m\",\n  \"temperature_[c]\",\n  \"oxygen_[ml/l]\",\n  \"salinity_[psu]\",\n  \"nitrates_[um]\",\n  \"nitrate_[um]\",\n  \"orthophosphate_[um]\",\n  \"silicic_acid_[um]\",\n  \"distance_from_coast_[km]\",\n]\np.plot_metadata_by_cluster(metadata_mofa, metadata_mofa[\"Cluster\"], env_vars)\n\n\n\n\n\n\n\n\n\n\n\n\np.scatter_plot_2d(\n    m_mofa_clusters[\"Factor_1\"],\n    m_mofa_clusters[\"Factor_2\"],\n    c=m_mofa_clusters[\"Cluster\"],\n    xlabel=\"MOFA Factor 1\",\n    ylabel=\"MOFA Factor 2\",\n    title=\"MOFA Factors 1 vs 2 Colored by Cluster\",\n    s=30,\n    alpha=0.7,\n)"
  },
  {
    "objectID": "reports/clustering_analysis.html#resumen",
    "href": "reports/clustering_analysis.html#resumen",
    "title": "Cluster Interpretation & Analysis",
    "section": "",
    "text": "Análisis de los clusters obtenidos: distribución geográfica, perfiles de metadatos y determinación de características biológicas (Features) determinantes.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.plots as p\nimport warnings\n\nImportar datos procesados de MOFA y resultados de clustering.\n\nselected_clusters = du.load_data(\n    \"clustering_dir/selected_clusters_GMM_Opt\", index_col=0\n)\nmetadata = du.load_data(\"processed_metadata/Metadata_aggregated\", index_col=1)\nm_clr = du.load_data(\"clr_data/M_clr\", index_col=0)\nm_mofa = du.load_data(\"MOFA_dir/M_factors\", index_col=0)\n\nmetadata_mofa = metadata.join(selected_clusters)\nm_mofa_clusters = m_mofa.join(selected_clusters)\n\n\n\n\ndepths = metadata_mofa[\"depth_m\"].unique()\nfor depth in depths:\n    metadata_depth = metadata_mofa[metadata_mofa[\"depth_m\"] == depth]\n    p.plot_geo_clusters(\n        metadata_depth,\n        metadata_depth[\"Cluster\"],\n        lat_col=\"latitude\",\n        lon_col=\"longitude\",\n        title=\"Geographic Distribution of MOFA Clusters at Depth: \" + str(depth) + \" m\",\n        n_clusters=len(metadata_mofa[\"Cluster\"].unique()),\n    )\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\np.plot_geo_clusters_3d(\n    metadata_mofa,\n    metadata_mofa[\"Cluster\"],\n    lat_col=\"latitude\",\n    lon_col=\"longitude\",\n    depth_col=\"depth_m\",\n    title=\"3D Geographic Distribution of MOFA Clusters\",\n    n_clusters=len(metadata_mofa[\"Cluster\"].unique()),\n)\n\n\n\n\n\n\n\n\n\n\n\n\nwarnings.filterwarnings(\"ignore\")\n\nenv_vars = [\n  \"depth_m\",\n  \"temperature_[c]\",\n  \"oxygen_[ml/l]\",\n  \"salinity_[psu]\",\n  \"nitrates_[um]\",\n  \"nitrate_[um]\",\n  \"orthophosphate_[um]\",\n  \"silicic_acid_[um]\",\n  \"distance_from_coast_[km]\",\n]\np.plot_metadata_by_cluster(metadata_mofa, metadata_mofa[\"Cluster\"], env_vars)\n\n\n\n\n\n\n\n\n\n\n\n\np.scatter_plot_2d(\n    m_mofa_clusters[\"Factor_1\"],\n    m_mofa_clusters[\"Factor_2\"],\n    c=m_mofa_clusters[\"Cluster\"],\n    xlabel=\"MOFA Factor 1\",\n    ylabel=\"MOFA Factor 2\",\n    title=\"MOFA Factors 1 vs 2 Colored by Cluster\",\n    s=30,\n    alpha=0.7,\n)"
  },
  {
    "objectID": "reports/mofa_pca_analysis.html",
    "href": "reports/mofa_pca_analysis.html",
    "title": "MOFA & PCA analysis",
    "section": "",
    "text": "En este informe, se realiza un análisis comparativo entre los resultados obtenidos mediante PCA y MOFA. Además, de un análisis de los factores y componentes principales obtenidos incluyendo la metadata asociada.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport src.data_utils as du\nimport src.plots as p\n\nImportar datos procesados de PCA y MOFA.\n\nDATA_DIR = \"../data/\"\nPROCESSED_DATA_DIR = DATA_DIR + \"processed_data/\"\nMOFA_DATA_DIR = DATA_DIR + \"MOFA_dir/\"\nPROCESSED_METADATA_DIR = DATA_DIR + \"processed_metadata/\"\n\n# Matriz de componentes de PCA\nm_pca = du.load_data(PROCESSED_DATA_DIR + \"M_pca\", index_col=0)\n\n# Matriz de fatores de MOFA\nm_factors = du.load_data(MOFA_DATA_DIR + \"M_factors\", index_col=0)\n\n# Matriz de varianza explicada\nvariance_explained = du.load_data(MOFA_DATA_DIR + \"M_variance_explained\", index_col=0)\n\n# Matrices de pesos de MOFA, por cada una de las vistas\nw_biogeochemical_genes = du.load_data(\n    MOFA_DATA_DIR + \"W_biogeochemical_genes\", index_col=0\n)\nw_metabolic_genes = du.load_data(MOFA_DATA_DIR + \"W_metabolic_genes\", index_col=0)\nw_taxa_order = du.load_data(MOFA_DATA_DIR + \"W_taxa_order\", index_col=0)\nw_taxa_phylum = du.load_data(MOFA_DATA_DIR + \"W_taxa_phylum\", index_col=0)\n\n# Matriz de metadata agregada\nmetadata = du.load_data(PROCESSED_METADATA_DIR + \"Metadata_aggregated\", index_col=0)\n\nAnálisis visual de PCA\n\npca_1 = m_pca[\"PCA1\"]\npca_2 = m_pca[\"PCA2\"]\npca_3 = m_pca[\"PCA3\"]\np.scatter_plot_3d(\n    pca_1,\n    pca_2,\n    pca_3,\n    xlabel=\"PCA 1\",\n    ylabel=\"PCA 2\",\n    title=\"PCA 3D Scatter Plot\",\n    s=40,\n)\n\n\n\n\n\n\n\n\nAnálisis visual de MOFA\n\nmofa_1 = m_factors[\"Factor_1\"]\nmofa_2 = m_factors[\"Factor_2\"]\nmofa_3 = m_factors[\"Factor_3\"]\np.scatter_plot_3d(\n    mofa_1,\n    mofa_2,\n    mofa_3,\n    xlabel=\"MOFA Factor 1\",\n    ylabel=\"MOFA Factor 2\",\n    title=\"MOFA 3D Scatter Plot\",\n    s=40,\n)\n\n\n\n\n\n\n\n\nComparar visualmente PCA y MOFA en sus primeras tres dimensiones.\n\np.doble_scatter_plot_3d(\n    mofa_1,\n    mofa_2,\n    mofa_3,\n    pca_1,\n    pca_2,\n    pca_3,\n    xlabel1=\"MOFA Factor 1\",\n    ylabel1=\"MOFA Factor 2\",\n    xlabel2=\"PCA 1\",\n    ylabel2=\"PCA 2\",\n    title1=\"MOFA 3D Scatter Plot\",\n    title2=\"PCA 3D Scatter Plot\",\n    s=20,\n)\n\n\n\n\n\n\n\n\nVariance explicada por cada factor y vista en MOFA.\n\np.plot_variance_explained(variance_explained)\n\n\n\n\n\n\n\n\nCaracteristicas más importantes por factor en MOFA.\n\nnum_factors = 2\nnum_top_features = 10\ntop_features_biogeochemical_genes = p.plot_factor_top_features(\n    w_biogeochemical_genes, num_factors=num_factors, num_top_features=num_top_features\n)\ndisplay(top_features_biogeochemical_genes)\n\n\n\n\n\n\n\n\n[   Feature_number Feature_name\n 0              47         pufm\n 1              13         cutl\n 2              14         cutm\n 3              12         cpet\n 4              49         rbcs\n 5              39         nosz\n 6              45         psaa\n 7              46         psba\n 8              38         norb\n 9              43         peth,\n    Feature_number Feature_name\n 0              37         nirs\n 1              38         norb\n 2              40         nrfa\n 3               5         apra\n 4              27         met3\n 5               0         abfd\n 6              19         cysj\n 7              29         napa\n 8              36         nirk\n 9              39         nosz]\n\n\n\ntop_features_metabolic_genes = p.plot_factor_top_features(\n    w_metabolic_genes, num_factors=num_factors, num_top_features=num_top_features\n)\ndisplay(top_features_metabolic_genes)\n\n\n\n\n\n\n\n\n[   Feature_number Feature_name\n 0             246         amsj\n 1            1886        lhcb5\n 2            1617         heps\n 3            1285         frdd\n 4            3236         sirc\n 5            1881        lhca3\n 6            1467          glu\n 7            2424         ntpb\n 8            1879        lhca1\n 9            3579          vde,\n    Feature_number Feature_name\n 0            2812         porc\n 1            2522         padg\n 2            3589         vorb\n 3            2374         nirs\n 4             341         asda\n 5            2319         ndhs\n 6             549          buk\n 7            3588         vora\n 8             830         csxa\n 9            2205         mtrh]\n\n\n\ntop_features_taxa_order = p.plot_factor_top_features(\n    w_taxa_order, num_factors=num_factors, num_top_features=num_top_features\n)\ndisplay(top_features_taxa_order)\n\n\n\n\n\n\n\n\n[   Feature_number                              Feature_name\n 0              42  Deltaproteobacteria order incertae sedis\n 1              52       Thaumarchaeota order incertae sedis\n 2               7                               Mamiellales\n 3               9                           Cellvibrionales\n 4               2                             Nitrospinales\n 5              40          Chloroflexi order incertae sedis\n 6              19                          Nitrosopumilales\n 7              11                           Synechococcales\n 8              15                           Rhodobacterales\n 9              45       Flavobacteriia order incertae sedis,\n    Feature_number                              Feature_name\n 0              44           Firmicutes order incertae sedis\n 1              47          Nitrospinae order incertae sedis\n 2              35              Archaea order incertae sedis\n 3              42  Deltaproteobacteria order incertae sedis\n 4              19                          Nitrosopumilales\n 5              52       Thaumarchaeota order incertae sedis\n 6              14                          Rhodospirillales\n 7              31       Acidimicrobiia order incertae sedis\n 8              20                          Nitrosomonadales\n 9              18                          Gemmatimonadales]\n\n\n\ntop_features_taxa_phylum = p.plot_factor_top_features(\n    w_taxa_phylum, num_factors=num_factors, num_top_features=num_top_features\n)\ndisplay(top_features_taxa_phylum)\n\n\n\n\n\n\n\n\n[   Feature_number                   Feature_name\n 0              13                 Thaumarchaeota\n 1               3                    Nitrospinae\n 2              10                    Chlorophyta\n 3               6                    Chloroflexi\n 4              16  Archaea phylum incertae sedis\n 5               0                  Cyanobacteria\n 6              11                  Acidobacteria\n 7               7                 Actinobacteria\n 8              15                  Bacteroidetes\n 9               8                 Planctomycetes,\n    Feature_number                   Feature_name\n 0               2                     Firmicutes\n 1              13                 Thaumarchaeota\n 2              16  Archaea phylum incertae sedis\n 3               4               Gemmatimonadetes\n 4               9                  Euryarchaeota\n 5              11                  Acidobacteria\n 6               7                 Actinobacteria\n 7              15                  Bacteroidetes\n 8               5                   Balneolaeota\n 9               6                    Chloroflexi]\n\n\nAnálisis de relación entre factores de MOFA y metadata.\n\nnumerical_columns_metadata = metadata.select_dtypes(\n    include=[np.number]\n).columns.tolist()\nnumerical_columns_metadata.remove(\"day\")\nnumerical_columns_metadata.remove(\"hour\")\nnumerical_columns_metadata.remove(\"minute\")\nnumerical_columns_metadata.remove(\"second\")\nnumerical_columns_metadata.remove(\"year\")\nnumerical_columns_metadata.remove(\"month\")\ncolumns_metadata = numerical_columns_metadata\np.plot_factor_metadata(mofa_1, mofa_2, metadata, columns_metadata)"
  },
  {
    "objectID": "reports/mofa_pca_analysis.html#resumen",
    "href": "reports/mofa_pca_analysis.html#resumen",
    "title": "MOFA & PCA analysis",
    "section": "",
    "text": "En este informe, se realiza un análisis comparativo entre los resultados obtenidos mediante PCA y MOFA. Además, de un análisis de los factores y componentes principales obtenidos incluyendo la metadata asociada.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport src.data_utils as du\nimport src.plots as p\n\nImportar datos procesados de PCA y MOFA.\n\nDATA_DIR = \"../data/\"\nPROCESSED_DATA_DIR = DATA_DIR + \"processed_data/\"\nMOFA_DATA_DIR = DATA_DIR + \"MOFA_dir/\"\nPROCESSED_METADATA_DIR = DATA_DIR + \"processed_metadata/\"\n\n# Matriz de componentes de PCA\nm_pca = du.load_data(PROCESSED_DATA_DIR + \"M_pca\", index_col=0)\n\n# Matriz de fatores de MOFA\nm_factors = du.load_data(MOFA_DATA_DIR + \"M_factors\", index_col=0)\n\n# Matriz de varianza explicada\nvariance_explained = du.load_data(MOFA_DATA_DIR + \"M_variance_explained\", index_col=0)\n\n# Matrices de pesos de MOFA, por cada una de las vistas\nw_biogeochemical_genes = du.load_data(\n    MOFA_DATA_DIR + \"W_biogeochemical_genes\", index_col=0\n)\nw_metabolic_genes = du.load_data(MOFA_DATA_DIR + \"W_metabolic_genes\", index_col=0)\nw_taxa_order = du.load_data(MOFA_DATA_DIR + \"W_taxa_order\", index_col=0)\nw_taxa_phylum = du.load_data(MOFA_DATA_DIR + \"W_taxa_phylum\", index_col=0)\n\n# Matriz de metadata agregada\nmetadata = du.load_data(PROCESSED_METADATA_DIR + \"Metadata_aggregated\", index_col=0)\n\nAnálisis visual de PCA\n\npca_1 = m_pca[\"PCA1\"]\npca_2 = m_pca[\"PCA2\"]\npca_3 = m_pca[\"PCA3\"]\np.scatter_plot_3d(\n    pca_1,\n    pca_2,\n    pca_3,\n    xlabel=\"PCA 1\",\n    ylabel=\"PCA 2\",\n    title=\"PCA 3D Scatter Plot\",\n    s=40,\n)\n\n\n\n\n\n\n\n\nAnálisis visual de MOFA\n\nmofa_1 = m_factors[\"Factor_1\"]\nmofa_2 = m_factors[\"Factor_2\"]\nmofa_3 = m_factors[\"Factor_3\"]\np.scatter_plot_3d(\n    mofa_1,\n    mofa_2,\n    mofa_3,\n    xlabel=\"MOFA Factor 1\",\n    ylabel=\"MOFA Factor 2\",\n    title=\"MOFA 3D Scatter Plot\",\n    s=40,\n)\n\n\n\n\n\n\n\n\nComparar visualmente PCA y MOFA en sus primeras tres dimensiones.\n\np.doble_scatter_plot_3d(\n    mofa_1,\n    mofa_2,\n    mofa_3,\n    pca_1,\n    pca_2,\n    pca_3,\n    xlabel1=\"MOFA Factor 1\",\n    ylabel1=\"MOFA Factor 2\",\n    xlabel2=\"PCA 1\",\n    ylabel2=\"PCA 2\",\n    title1=\"MOFA 3D Scatter Plot\",\n    title2=\"PCA 3D Scatter Plot\",\n    s=20,\n)\n\n\n\n\n\n\n\n\nVariance explicada por cada factor y vista en MOFA.\n\np.plot_variance_explained(variance_explained)\n\n\n\n\n\n\n\n\nCaracteristicas más importantes por factor en MOFA.\n\nnum_factors = 2\nnum_top_features = 10\ntop_features_biogeochemical_genes = p.plot_factor_top_features(\n    w_biogeochemical_genes, num_factors=num_factors, num_top_features=num_top_features\n)\ndisplay(top_features_biogeochemical_genes)\n\n\n\n\n\n\n\n\n[   Feature_number Feature_name\n 0              47         pufm\n 1              13         cutl\n 2              14         cutm\n 3              12         cpet\n 4              49         rbcs\n 5              39         nosz\n 6              45         psaa\n 7              46         psba\n 8              38         norb\n 9              43         peth,\n    Feature_number Feature_name\n 0              37         nirs\n 1              38         norb\n 2              40         nrfa\n 3               5         apra\n 4              27         met3\n 5               0         abfd\n 6              19         cysj\n 7              29         napa\n 8              36         nirk\n 9              39         nosz]\n\n\n\ntop_features_metabolic_genes = p.plot_factor_top_features(\n    w_metabolic_genes, num_factors=num_factors, num_top_features=num_top_features\n)\ndisplay(top_features_metabolic_genes)\n\n\n\n\n\n\n\n\n[   Feature_number Feature_name\n 0             246         amsj\n 1            1886        lhcb5\n 2            1617         heps\n 3            1285         frdd\n 4            3236         sirc\n 5            1881        lhca3\n 6            1467          glu\n 7            2424         ntpb\n 8            1879        lhca1\n 9            3579          vde,\n    Feature_number Feature_name\n 0            2812         porc\n 1            2522         padg\n 2            3589         vorb\n 3            2374         nirs\n 4             341         asda\n 5            2319         ndhs\n 6             549          buk\n 7            3588         vora\n 8             830         csxa\n 9            2205         mtrh]\n\n\n\ntop_features_taxa_order = p.plot_factor_top_features(\n    w_taxa_order, num_factors=num_factors, num_top_features=num_top_features\n)\ndisplay(top_features_taxa_order)\n\n\n\n\n\n\n\n\n[   Feature_number                              Feature_name\n 0              42  Deltaproteobacteria order incertae sedis\n 1              52       Thaumarchaeota order incertae sedis\n 2               7                               Mamiellales\n 3               9                           Cellvibrionales\n 4               2                             Nitrospinales\n 5              40          Chloroflexi order incertae sedis\n 6              19                          Nitrosopumilales\n 7              11                           Synechococcales\n 8              15                           Rhodobacterales\n 9              45       Flavobacteriia order incertae sedis,\n    Feature_number                              Feature_name\n 0              44           Firmicutes order incertae sedis\n 1              47          Nitrospinae order incertae sedis\n 2              35              Archaea order incertae sedis\n 3              42  Deltaproteobacteria order incertae sedis\n 4              19                          Nitrosopumilales\n 5              52       Thaumarchaeota order incertae sedis\n 6              14                          Rhodospirillales\n 7              31       Acidimicrobiia order incertae sedis\n 8              20                          Nitrosomonadales\n 9              18                          Gemmatimonadales]\n\n\n\ntop_features_taxa_phylum = p.plot_factor_top_features(\n    w_taxa_phylum, num_factors=num_factors, num_top_features=num_top_features\n)\ndisplay(top_features_taxa_phylum)\n\n\n\n\n\n\n\n\n[   Feature_number                   Feature_name\n 0              13                 Thaumarchaeota\n 1               3                    Nitrospinae\n 2              10                    Chlorophyta\n 3               6                    Chloroflexi\n 4              16  Archaea phylum incertae sedis\n 5               0                  Cyanobacteria\n 6              11                  Acidobacteria\n 7               7                 Actinobacteria\n 8              15                  Bacteroidetes\n 9               8                 Planctomycetes,\n    Feature_number                   Feature_name\n 0               2                     Firmicutes\n 1              13                 Thaumarchaeota\n 2              16  Archaea phylum incertae sedis\n 3               4               Gemmatimonadetes\n 4               9                  Euryarchaeota\n 5              11                  Acidobacteria\n 6               7                 Actinobacteria\n 7              15                  Bacteroidetes\n 8               5                   Balneolaeota\n 9               6                    Chloroflexi]\n\n\nAnálisis de relación entre factores de MOFA y metadata.\n\nnumerical_columns_metadata = metadata.select_dtypes(\n    include=[np.number]\n).columns.tolist()\nnumerical_columns_metadata.remove(\"day\")\nnumerical_columns_metadata.remove(\"hour\")\nnumerical_columns_metadata.remove(\"minute\")\nnumerical_columns_metadata.remove(\"second\")\nnumerical_columns_metadata.remove(\"year\")\nnumerical_columns_metadata.remove(\"month\")\ncolumns_metadata = numerical_columns_metadata\np.plot_factor_metadata(mofa_1, mofa_2, metadata, columns_metadata)"
  },
  {
    "objectID": "reports/mofa.html",
    "href": "reports/mofa.html",
    "title": "MOFA",
    "section": "",
    "text": "En este informe, se realiza una reducción de dimensionalidad utilizando MOFA (Multi-Omics Factor Analysis) sobre los conjuntos de datos principales.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport muon as mu\nimport mofax as mofa\nimport matplotlib.pyplot as plt\nfrom src.mofa_utils import create_mudata\nimport src.data_utils as du\n\nCrear el directorio para guardar los datos procesados.\n\nmdata = create_mudata(\n    \"M_biogeochemical_genes_clr\",\n    \"M_metabolic_genes_clr\",\n    \"M_taxa_order_clr\",\n    \"M_taxa_phylum_clr\",\n)\nmdata\n\n/home/davidnfu0/.conda/envs/Omic_Integration/lib/python3.13/site-packages/mudata/_core/mudata.py:1598: FutureWarning:\n\nFrom 0.4 .update() will not pull obs/var columns from individual modalities by default anymore. Set mudata.set_options(pull_on_update=False) to adopt the new behaviour, which will become the default. Use new pull_obs/pull_var and push_obs/push_var methods for more flexibility.\n\n/home/davidnfu0/.conda/envs/Omic_Integration/lib/python3.13/site-packages/mudata/_core/mudata.py:963: UserWarning:\n\nCannot join columns with the same name because var_names are intersecting.\n\n/home/davidnfu0/.conda/envs/Omic_Integration/lib/python3.13/site-packages/mudata/_core/mudata.py:1461: FutureWarning:\n\nFrom 0.4 .update() will not pull obs/var columns from individual modalities by default anymore. Set mudata.set_options(pull_on_update=False) to adopt the new behaviour, which will become the default. Use new pull_obs/pull_var and push_obs/push_var methods for more flexibility.\n\n\n\nMuData object with n_obs × n_vars = 159 × 3860\n  4 modalities\n    biogeochemical_genes:   159 x 53\n    metabolic_genes:    159 x 3730\n    taxa_order: 159 x 57\n    taxa_phylum:    159 x 20\n\n\nCrear y carpeta para guardar modelos en caso de que no exista.\n\nMODEL_DIR = \"../models/\"\nMODEL_PATH = f\"{MODEL_DIR}mofa_model.hdf5\"\nif not os.path.exists(MODEL_DIR):\n    os.makedirs(MODEL_DIR, exist_ok=True)\nM_biogeochemical_genes = mdata.mod[\"biogeochemical_genes\"]\nM_metabolic_genes = mdata.mod[\"metabolic_genes\"]\nM_Taxa_order = mdata.mod[\"taxa_order\"]\nM_Taxa_phylum = mdata.mod[\"taxa_phylum\"]\n\nConstruir modelo MOFA si no existe.\n\nif not os.path.exists(MODEL_PATH):\n    mu.tl.mofa(\n        mdata,\n        use_obs=\"union\",\n        n_factors=20,\n        likelihoods=[\"gaussian\", \"gaussian\", \"gaussian\", \"gaussian\"],\n        convergence_mode=\"slow\",\n        outfile=MODEL_PATH,\n    )\nmodel = mofa.mofa_model(MODEL_PATH)\n\nObtener matriz de factores y guardarla en un DataFrame.\n\nZ = model.get_factors()\nZ_df = pd.DataFrame(Z)\nZ_df.columns = [f\"Factor_{i + 1}\" for i in range(Z_df.shape[1])]\nZ_df.index = mdata.obs_names\nZ_df.head(3)\n\n\n\n\n\n\n\n\nFactor_1\nFactor_2\nFactor_3\nFactor_4\nFactor_5\nFactor_6\nFactor_7\nFactor_8\nFactor_9\nFactor_10\nFactor_11\nFactor_12\nFactor_13\nFactor_14\nFactor_15\nFactor_16\nFactor_17\nFactor_18\nFactor_19\nFactor_20\n\n\n\n\nS10_Z00\n2.389635\n0.028005\n1.972506\n-0.828237\n-0.527246\n3.134912\n-1.110533\n-0.352389\n0.177640\n-0.134339\n-1.257871\n1.080348\n-0.328570\n0.808221\n0.398998\n-0.118267\n-1.161757\n0.739093\n0.163177\n-0.350056\n\n\nS10_Z01\n1.316186\n-0.360084\n2.420419\n-1.954678\n0.532125\n0.568336\n-1.465013\n-0.633575\n0.143488\n-0.223053\n-1.251377\n0.160722\n-0.301463\n0.465970\n-0.202504\n-0.259261\n-0.539122\n-0.311538\n0.404055\n0.041960\n\n\nS10_Z05\n-1.223780\n-1.609406\n-0.108783\n-1.168370\n1.685390\n0.254305\n-0.358795\n-1.012148\n0.030728\n-0.789844\n-0.699629\n-0.770518\n0.059229\n-0.208691\n0.174000\n-0.112676\n0.099146\n-0.514798\n0.311976\n-0.169920\n\n\n\n\n\n\n\nGuardar matriz de factores.\n\nMOFA_DATA_DIR = \"../data/MOFA_dir/\"\nZ_df.to_csv(f\"{MOFA_DATA_DIR}M_factors.csv\")\n\nAnalizar la varianza explicada por cada factor y vista.\n\nvariance_explained = model.get_r2()\nvariance_explained.drop(columns=[\"Group\"], inplace=True)\nvariance_explained[\"Factor\"] = variance_explained[\"Factor\"].str.replace(\n    r\"Factor(\\d{1})$\", r\"Factor0\\1\", regex=True\n)\nvariance_explained_pivot = variance_explained.pivot(\n    index=\"Factor\", columns=\"View\", values=\"R2\"\n)\nvariance_explained_pivot\n\n\n\n\n\n\n\nView\nbiogeochemical_genes\nmetabolic_genes\ntaxa_order\ntaxa_phylum\n\n\nFactor\n\n\n\n\n\n\n\n\nFactor01\n45.149911\n25.785402\n32.186048\n30.266552\n\n\nFactor02\n8.398774\n5.428812\n9.213591\n8.448124\n\n\nFactor03\n18.163510\n4.529129\n2.142690\n3.815433\n\n\nFactor04\n2.473904\n3.553698\n8.475756\n3.481291\n\n\nFactor05\n3.013050\n2.449061\n5.835098\n5.596379\n\n\nFactor06\n4.243380\n3.728999\n3.407018\n4.323741\n\n\nFactor07\n0.694031\n1.088232\n2.127132\n3.229796\n\n\nFactor08\n2.517398\n1.962799\n0.947357\n1.624481\n\n\nFactor09\n2.318068\n1.633325\n1.675868\n0.707135\n\n\nFactor10\n2.212548\n1.068946\n1.785243\n1.144207\n\n\nFactor11\n0.398914\n2.444207\n1.025817\n0.681215\n\n\nFactor12\n0.816978\n1.413154\n1.073878\n1.237019\n\n\nFactor13\n0.493651\n0.956850\n1.700527\n0.782442\n\n\nFactor14\n1.650193\n0.497910\n0.804199\n0.652869\n\n\nFactor15\n0.938792\n0.631126\n0.882156\n0.955146\n\n\nFactor16\n1.302497\n0.413250\n0.573852\n0.752915\n\n\nFactor17\n0.381822\n0.590710\n0.928276\n0.817454\n\n\nFactor18\n0.209711\n0.202961\n0.409830\n0.640610\n\n\nFactor19\n0.092102\n0.225398\n0.426449\n0.178003\n\n\nFactor20\n0.026440\n0.081663\n0.125206\n0.340525\n\n\n\n\n\n\n\nGuardar la varianza explicada.\n\nvariance_explained_pivot.to_csv(f\"{MOFA_DATA_DIR}M_variance_explained.csv\")\n\nVisualizar la varianza explicada por cada factor y vista.\n\nplt.figure(figsize=(10, 6))\nplt.imshow(variance_explained_pivot, aspect=\"auto\", cmap=\"Blues\")\nplt.xticks(\n    ticks=range(len(variance_explained_pivot.columns)),\n    labels=variance_explained_pivot.columns,\n    rotation=45,\n)\nplt.yticks(\n    ticks=range(len(variance_explained_pivot.index)),\n    labels=variance_explained_pivot.index,\n)\nplt.colorbar(label=\"R2 (%)\")\nplt.title(\"Variance Explained per Factor and View\")\nplt.tight_layout()\n\n\n\n\n\n\n\n\nObtener los pesos de las variables para cada vista.\n\nW = model.get_weights()\n\nn_bio = M_biogeochemical_genes.n_vars\nn_met = M_metabolic_genes.n_vars\nn_order = M_Taxa_order.n_vars\nn_phylum = M_Taxa_phylum.n_vars\n\nidx_bio = slice(0, n_bio)\nidx_met = slice(n_bio, n_bio + n_met)\nidx_order = slice(n_bio + n_met, n_bio + n_met + n_order)\nidx_phylum = slice(n_bio + n_met + n_order, n_bio + n_met + n_order + n_phylum)\n\nW_bio = W[idx_bio, :]\nW_met = W[idx_met, :]\nW_order = W[idx_order, :]\nW_phylum = W[idx_phylum, :]\n\nGuardar los pesos de las variables para cada vista.\n\npd.DataFrame(W_bio, index=M_biogeochemical_genes.var_names).to_csv(\n    f\"{MOFA_DATA_DIR}W_biogeochemical_genes.csv\"\n)\npd.DataFrame(W_met, index=M_metabolic_genes.var_names).to_csv(\n    f\"{MOFA_DATA_DIR}W_metabolic_genes.csv\"\n)\npd.DataFrame(W_order, index=M_Taxa_order.var_names).to_csv(\n    f\"{MOFA_DATA_DIR}W_taxa_order.csv\"\n)\npd.DataFrame(W_phylum, index=M_Taxa_phylum.var_names).to_csv(\n    f\"{MOFA_DATA_DIR}W_taxa_phylum.csv\"\n)"
  },
  {
    "objectID": "reports/mofa.html#resumen",
    "href": "reports/mofa.html#resumen",
    "title": "MOFA",
    "section": "",
    "text": "En este informe, se realiza una reducción de dimensionalidad utilizando MOFA (Multi-Omics Factor Analysis) sobre los conjuntos de datos principales.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport muon as mu\nimport mofax as mofa\nimport matplotlib.pyplot as plt\nfrom src.mofa_utils import create_mudata\nimport src.data_utils as du\n\nCrear el directorio para guardar los datos procesados.\n\nmdata = create_mudata(\n    \"M_biogeochemical_genes_clr\",\n    \"M_metabolic_genes_clr\",\n    \"M_taxa_order_clr\",\n    \"M_taxa_phylum_clr\",\n)\nmdata\n\n/home/davidnfu0/.conda/envs/Omic_Integration/lib/python3.13/site-packages/mudata/_core/mudata.py:1598: FutureWarning:\n\nFrom 0.4 .update() will not pull obs/var columns from individual modalities by default anymore. Set mudata.set_options(pull_on_update=False) to adopt the new behaviour, which will become the default. Use new pull_obs/pull_var and push_obs/push_var methods for more flexibility.\n\n/home/davidnfu0/.conda/envs/Omic_Integration/lib/python3.13/site-packages/mudata/_core/mudata.py:963: UserWarning:\n\nCannot join columns with the same name because var_names are intersecting.\n\n/home/davidnfu0/.conda/envs/Omic_Integration/lib/python3.13/site-packages/mudata/_core/mudata.py:1461: FutureWarning:\n\nFrom 0.4 .update() will not pull obs/var columns from individual modalities by default anymore. Set mudata.set_options(pull_on_update=False) to adopt the new behaviour, which will become the default. Use new pull_obs/pull_var and push_obs/push_var methods for more flexibility.\n\n\n\nMuData object with n_obs × n_vars = 159 × 3860\n  4 modalities\n    biogeochemical_genes:   159 x 53\n    metabolic_genes:    159 x 3730\n    taxa_order: 159 x 57\n    taxa_phylum:    159 x 20\n\n\nCrear y carpeta para guardar modelos en caso de que no exista.\n\nMODEL_DIR = \"../models/\"\nMODEL_PATH = f\"{MODEL_DIR}mofa_model.hdf5\"\nif not os.path.exists(MODEL_DIR):\n    os.makedirs(MODEL_DIR, exist_ok=True)\nM_biogeochemical_genes = mdata.mod[\"biogeochemical_genes\"]\nM_metabolic_genes = mdata.mod[\"metabolic_genes\"]\nM_Taxa_order = mdata.mod[\"taxa_order\"]\nM_Taxa_phylum = mdata.mod[\"taxa_phylum\"]\n\nConstruir modelo MOFA si no existe.\n\nif not os.path.exists(MODEL_PATH):\n    mu.tl.mofa(\n        mdata,\n        use_obs=\"union\",\n        n_factors=20,\n        likelihoods=[\"gaussian\", \"gaussian\", \"gaussian\", \"gaussian\"],\n        convergence_mode=\"slow\",\n        outfile=MODEL_PATH,\n    )\nmodel = mofa.mofa_model(MODEL_PATH)\n\nObtener matriz de factores y guardarla en un DataFrame.\n\nZ = model.get_factors()\nZ_df = pd.DataFrame(Z)\nZ_df.columns = [f\"Factor_{i + 1}\" for i in range(Z_df.shape[1])]\nZ_df.index = mdata.obs_names\nZ_df.head(3)\n\n\n\n\n\n\n\n\nFactor_1\nFactor_2\nFactor_3\nFactor_4\nFactor_5\nFactor_6\nFactor_7\nFactor_8\nFactor_9\nFactor_10\nFactor_11\nFactor_12\nFactor_13\nFactor_14\nFactor_15\nFactor_16\nFactor_17\nFactor_18\nFactor_19\nFactor_20\n\n\n\n\nS10_Z00\n2.389635\n0.028005\n1.972506\n-0.828237\n-0.527246\n3.134912\n-1.110533\n-0.352389\n0.177640\n-0.134339\n-1.257871\n1.080348\n-0.328570\n0.808221\n0.398998\n-0.118267\n-1.161757\n0.739093\n0.163177\n-0.350056\n\n\nS10_Z01\n1.316186\n-0.360084\n2.420419\n-1.954678\n0.532125\n0.568336\n-1.465013\n-0.633575\n0.143488\n-0.223053\n-1.251377\n0.160722\n-0.301463\n0.465970\n-0.202504\n-0.259261\n-0.539122\n-0.311538\n0.404055\n0.041960\n\n\nS10_Z05\n-1.223780\n-1.609406\n-0.108783\n-1.168370\n1.685390\n0.254305\n-0.358795\n-1.012148\n0.030728\n-0.789844\n-0.699629\n-0.770518\n0.059229\n-0.208691\n0.174000\n-0.112676\n0.099146\n-0.514798\n0.311976\n-0.169920\n\n\n\n\n\n\n\nGuardar matriz de factores.\n\nMOFA_DATA_DIR = \"../data/MOFA_dir/\"\nZ_df.to_csv(f\"{MOFA_DATA_DIR}M_factors.csv\")\n\nAnalizar la varianza explicada por cada factor y vista.\n\nvariance_explained = model.get_r2()\nvariance_explained.drop(columns=[\"Group\"], inplace=True)\nvariance_explained[\"Factor\"] = variance_explained[\"Factor\"].str.replace(\n    r\"Factor(\\d{1})$\", r\"Factor0\\1\", regex=True\n)\nvariance_explained_pivot = variance_explained.pivot(\n    index=\"Factor\", columns=\"View\", values=\"R2\"\n)\nvariance_explained_pivot\n\n\n\n\n\n\n\nView\nbiogeochemical_genes\nmetabolic_genes\ntaxa_order\ntaxa_phylum\n\n\nFactor\n\n\n\n\n\n\n\n\nFactor01\n45.149911\n25.785402\n32.186048\n30.266552\n\n\nFactor02\n8.398774\n5.428812\n9.213591\n8.448124\n\n\nFactor03\n18.163510\n4.529129\n2.142690\n3.815433\n\n\nFactor04\n2.473904\n3.553698\n8.475756\n3.481291\n\n\nFactor05\n3.013050\n2.449061\n5.835098\n5.596379\n\n\nFactor06\n4.243380\n3.728999\n3.407018\n4.323741\n\n\nFactor07\n0.694031\n1.088232\n2.127132\n3.229796\n\n\nFactor08\n2.517398\n1.962799\n0.947357\n1.624481\n\n\nFactor09\n2.318068\n1.633325\n1.675868\n0.707135\n\n\nFactor10\n2.212548\n1.068946\n1.785243\n1.144207\n\n\nFactor11\n0.398914\n2.444207\n1.025817\n0.681215\n\n\nFactor12\n0.816978\n1.413154\n1.073878\n1.237019\n\n\nFactor13\n0.493651\n0.956850\n1.700527\n0.782442\n\n\nFactor14\n1.650193\n0.497910\n0.804199\n0.652869\n\n\nFactor15\n0.938792\n0.631126\n0.882156\n0.955146\n\n\nFactor16\n1.302497\n0.413250\n0.573852\n0.752915\n\n\nFactor17\n0.381822\n0.590710\n0.928276\n0.817454\n\n\nFactor18\n0.209711\n0.202961\n0.409830\n0.640610\n\n\nFactor19\n0.092102\n0.225398\n0.426449\n0.178003\n\n\nFactor20\n0.026440\n0.081663\n0.125206\n0.340525\n\n\n\n\n\n\n\nGuardar la varianza explicada.\n\nvariance_explained_pivot.to_csv(f\"{MOFA_DATA_DIR}M_variance_explained.csv\")\n\nVisualizar la varianza explicada por cada factor y vista.\n\nplt.figure(figsize=(10, 6))\nplt.imshow(variance_explained_pivot, aspect=\"auto\", cmap=\"Blues\")\nplt.xticks(\n    ticks=range(len(variance_explained_pivot.columns)),\n    labels=variance_explained_pivot.columns,\n    rotation=45,\n)\nplt.yticks(\n    ticks=range(len(variance_explained_pivot.index)),\n    labels=variance_explained_pivot.index,\n)\nplt.colorbar(label=\"R2 (%)\")\nplt.title(\"Variance Explained per Factor and View\")\nplt.tight_layout()\n\n\n\n\n\n\n\n\nObtener los pesos de las variables para cada vista.\n\nW = model.get_weights()\n\nn_bio = M_biogeochemical_genes.n_vars\nn_met = M_metabolic_genes.n_vars\nn_order = M_Taxa_order.n_vars\nn_phylum = M_Taxa_phylum.n_vars\n\nidx_bio = slice(0, n_bio)\nidx_met = slice(n_bio, n_bio + n_met)\nidx_order = slice(n_bio + n_met, n_bio + n_met + n_order)\nidx_phylum = slice(n_bio + n_met + n_order, n_bio + n_met + n_order + n_phylum)\n\nW_bio = W[idx_bio, :]\nW_met = W[idx_met, :]\nW_order = W[idx_order, :]\nW_phylum = W[idx_phylum, :]\n\nGuardar los pesos de las variables para cada vista.\n\npd.DataFrame(W_bio, index=M_biogeochemical_genes.var_names).to_csv(\n    f\"{MOFA_DATA_DIR}W_biogeochemical_genes.csv\"\n)\npd.DataFrame(W_met, index=M_metabolic_genes.var_names).to_csv(\n    f\"{MOFA_DATA_DIR}W_metabolic_genes.csv\"\n)\npd.DataFrame(W_order, index=M_Taxa_order.var_names).to_csv(\n    f\"{MOFA_DATA_DIR}W_taxa_order.csv\"\n)\npd.DataFrame(W_phylum, index=M_Taxa_phylum.var_names).to_csv(\n    f\"{MOFA_DATA_DIR}W_taxa_phylum.csv\"\n)"
  },
  {
    "objectID": "reports/clr.html",
    "href": "reports/clr.html",
    "title": "CLR Transformation",
    "section": "",
    "text": "En este informe, se detalla el proceso de transformación CLR (Centered Log-Ratio) aplicado a las multiples matrices ómicas.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.data_normalization as dn\n\nDefinir el directorio de datos procesados y cargar las matrices ómicas.\n\nDATA_PROCESSED_DIR = \"../data/processed_data/\"\nM_biogeochemical_genes_pd = du.load_data(\n    DATA_PROCESSED_DIR + \"M_biogeochemical_genes\", index_col=0\n)\nM_metabolic_genes_pd = du.load_data(\n    DATA_PROCESSED_DIR + \"M_metabolic_genes\", index_col=0\n)\nM_taxa_order_pd = du.load_data(DATA_PROCESSED_DIR + \"M_taxa_order\", index_col=0)\nM_taxa_phylum_pd = du.load_data(DATA_PROCESSED_DIR + \"M_taxa_phylum\", index_col=0)\n\nExplorar ordenes de las matrices cargadas.\n\nM_biogeochemical_genes_pd.head(5)\n\n\n\n\n\n\n\n\nabfd\nacs\nacsb\napca\napcf\napra\naprb\ncoxl\ncoxm\ncoxs\n...\npeth\nprkb\npsaa\npsba\npufm\nrbcl\nrbcs\nsat\nsir\nsuox\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n359.26500\n160.26942\n13.03536\n551.80506\n503.93206\n31.17031\n2745.90727\n2193.68913\n2646.25809\n1990.82600\n...\n753.12482\n578.64676\n751.26299\n391.39658\n1211.17597\n263.23020\n601.13471\n1899.31977\n1748.68208\n30.37250\n\n\nS10_Z01\n13.43326\n104.11034\n15.99147\n376.32500\n576.59155\n3.81675\n3808.86923\n1847.60399\n2872.41969\n1779.57401\n...\n494.64409\n535.00770\n667.16508\n613.87983\n693.63110\n267.17403\n696.82120\n3360.56333\n1381.66879\n20.22587\n\n\nS10_Z05\n207.26238\n10.41636\n6.92328\n29.61720\n40.69934\n17.56785\n3565.34567\n2312.78238\n3963.81748\n1847.62309\n...\n30.93330\n178.00411\n43.85765\n12.39310\n117.83646\n39.76609\n29.51159\n4566.57900\n132.59523\n7.31381\n\n\nS11_Z00\n957.36366\n63.35688\n0.00000\n142.09083\n136.29833\n165.22989\n3635.90066\n1791.71607\n2556.46020\n1899.38764\n...\n213.32369\n229.89671\n290.87010\n284.08304\n396.60838\n185.10762\n185.63410\n2347.31152\n275.83163\n24.20977\n\n\nS11_Z01\n658.82872\n75.84249\n30.12646\n295.28445\n243.31355\n21.16518\n3570.86447\n1663.07110\n3296.77196\n1519.42635\n...\n416.76124\n352.35362\n336.44839\n414.26516\n490.55923\n188.88768\n319.24680\n3085.04002\n406.79209\n33.10402\n\n\n\n\n5 rows × 53 columns\n\n\n\n\nM_metabolic_genes_pd.head(5)\n\n\n\n\n\n\n\n\n4cl\n4hbd\na3galt2\na4galt\naaat\naacs\naadat\naae7\naanat\naao\n...\nyrrt\nysaa\nyvgn\nyvof\nywte\nyxei\nzadh2\nzds\nzep\nzwf\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n166.18297\n0.0\n3.1674\n0.000\n0.00000\n0.00000\n0.00000\n0.00000\n13.46850\n317.64736\n...\n74.9508\n152.42642\n57.07226\n21.63806\n0.0000\n0.0\n13.92290\n3.98649\n0.0\n4494.18542\n\n\nS10_Z01\n107.94783\n0.0\n0.0000\n0.000\n0.00000\n40.27773\n17.88460\n28.03790\n12.76687\n730.06630\n...\n14.2651\n321.58204\n116.87789\n25.77375\n0.0000\n0.0\n44.62057\n0.00000\n0.0\n3129.90803\n\n\nS10_Z05\n58.20414\n0.0\n0.0000\n0.000\n0.00000\n9.75746\n20.48633\n6.23535\n0.00000\n407.11690\n...\n0.0000\n151.68520\n104.82646\n0.00000\n11.6619\n0.0\n7.95161\n0.00000\n0.0\n1795.49998\n\n\nS11_Z00\n130.01854\n0.0\n0.0000\n12.253\n1.62613\n0.00000\n2.58491\n39.02711\n11.34800\n1116.99000\n...\n23.1765\n126.24522\n129.74392\n132.90209\n28.9742\n0.0\n0.00000\n0.00000\n0.0\n2866.70927\n\n\nS11_Z01\n112.42628\n0.0\n17.8416\n0.000\n0.00000\n7.37877\n33.86910\n18.94130\n5.33704\n137.75942\n...\n17.2048\n127.55050\n92.08360\n10.37549\n0.0000\n0.0\n73.44145\n0.00000\n0.0\n2186.26235\n\n\n\n\n5 rows × 3821 columns\n\n\n\n\nM_taxa_order_pd.head(5)\n\n\n\n\n\n\n\n\nNitrososphaerales\nChthonomonadales\nBacteroidetes Order II. Incertae sedis\nChroococcales\nPlanctomycetales\nCandidatus Brocadiales\nDesulfurococcales\nOscillatoriales\nNostocales\nDeinococcales\n...\nUnknown cellular organism order incertae sedis\nVerrucomicrobia order incertae sedis\nVerrucomicrobiae order incertae sedis\nZetaproteobacteria order incertae sedis\ncandidate division CPR3 order incertae sedis\ncandidate division NC10 order incertae sedis\ncandidate division WOR-3 order incertae sedis\ncandidate division WWE3 order incertae sedis\ncandidate division Zixibacteria order incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n0.0\n0.0\n0.0\n0.0\n0.000721\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.010844\n0.000000\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.344094\n\n\nS10_Z01\n0.0\n0.0\n0.0\n0.0\n0.001265\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006697\n0.000013\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.372401\n\n\nS10_Z05\n0.0\n0.0\n0.0\n0.0\n0.000871\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006435\n0.000223\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.387987\n\n\nS11_Z00\n0.0\n0.0\n0.0\n0.0\n0.006389\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.012144\n0.000549\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.321720\n\n\nS11_Z01\n0.0\n0.0\n0.0\n0.0\n0.003610\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006698\n0.000019\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.391293\n\n\n\n\n5 rows × 406 columns\n\n\n\n\nM_taxa_phylum_pd.head(5)\n\n\n\n\n\n\n\n\nChlorobi\nCyanobacteria\nIgnavibacteriae\nProteobacteria\nFirmicutes\nNitrospinae\nDeinococcus-Thermus\nKiritimatiellaeota\ncandidate division Zixibacteria\nGemmatimonadetes\n...\nBacteria phylum [Chlorobi/Ignavibacteriae]\nBacteria phylum [Firmicutes/Actinobacteria]\nBacteria phylum [Nitrospirae/Bacteroidetes]\nBacteria phylum [Proteobacteria/Actinobacteria]\nBacteria phylum [Proteobacteria/Armatimonadetes]\nBacteria phylum [Proteobacteria/Chloroflexi]\nBacteria phylum [Proteobacteria/Firmicutes]\nBacteria phylum incertae sedis\nUnknown cellular organism phylum incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n0.0\n0.023650\n0.0\n0.360825\n0.000015\n0.001655\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.068940\n0.0\n0.344094\n\n\nS10_Z01\n0.0\n0.020417\n0.0\n0.296810\n0.000026\n0.004243\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.115069\n0.0\n0.372401\n\n\nS10_Z05\n0.0\n0.001376\n0.0\n0.278321\n0.000065\n0.008446\n0.0\n0.0\n0.0\n0.000240\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.080827\n0.0\n0.387987\n\n\nS11_Z00\n0.0\n0.006062\n0.0\n0.315496\n0.000015\n0.003841\n0.0\n0.0\n0.0\n0.000496\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.119807\n0.0\n0.321720\n\n\nS11_Z01\n0.0\n0.011441\n0.0\n0.301691\n0.000065\n0.007352\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.140701\n0.0\n0.391293\n\n\n\n\n5 rows × 145 columns\n\n\n\nAplicar la transformación CLR a cada una de las matrices ómicas.\n\nM_biogeochemical_genes_clr_pd = dn.clr_transform(\n    M_biogeochemical_genes_pd, min_prevalence=0.01, min_variance=1e-4\n)[0]\nM_metabolic_genes_clr_pd = dn.clr_transform(\n    M_metabolic_genes_pd, min_prevalence=0.01, min_variance=1e-4\n)[0]\nM_taxa_order_clr_pd = dn.clr_transform(\n    M_taxa_order_pd, min_prevalence=1e-8, min_variance=1e-8\n)[0]\nM_taxa_phylum_clr_pd = dn.clr_transform(\n    M_taxa_phylum_pd, min_prevalence=1e-8, min_variance=1e-8\n)[0]\n\nExplorar las matrices transformadas.\n\nM_biogeochemical_genes_clr_pd.head(5)\n\n\n\n\n\n\n\n\nabfd\nacs\nacsb\napca\napcf\napra\naprb\ncoxl\ncoxm\ncoxs\n...\npeth\nprkb\npsaa\npsba\npufm\nrbcl\nrbcs\nsat\nsir\nsuox\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n0.156263\n-0.650941\n-3.160131\n0.585398\n0.494645\n-2.288331\n2.190070\n1.965543\n2.153105\n1.868508\n...\n0.896434\n0.632895\n0.893959\n0.241925\n1.371550\n-0.154768\n0.671022\n1.821454\n1.738821\n-2.314259\n\n\nS10_Z01\n-2.928854\n-0.881137\n-2.754532\n0.403865\n0.830546\n-4.187189\n2.718500\n1.995057\n2.436322\n1.957541\n...\n0.677251\n0.755693\n0.976450\n0.893211\n1.015352\n0.061312\n1.019941\n2.593276\n1.704459\n-2.519625\n\n\nS10_Z05\n0.520668\n-2.469940\n-2.878428\n-1.424962\n-1.107106\n-1.947247\n3.365699\n2.932889\n3.471645\n2.708338\n...\n-1.381484\n0.368489\n-1.032369\n-2.296178\n-0.044020\n-1.130303\n-1.428535\n3.613202\n0.073983\n-2.823553\n\n\nS11_Z00\n1.360033\n-1.355367\n-2.563941\n-0.547684\n-0.589304\n-0.396813\n2.694462\n1.986779\n2.342228\n2.045136\n...\n-0.141340\n-0.066520\n0.168726\n0.145116\n0.478799\n-0.283213\n-0.280373\n2.256875\n0.115640\n-2.317394\n\n\nS11_Z01\n1.059287\n-1.102518\n-2.025773\n0.256762\n0.063174\n-2.378819\n2.749386\n1.985244\n2.669522\n1.894911\n...\n0.601337\n0.433458\n0.387268\n0.595329\n0.764369\n-0.190024\n0.334788\n2.603143\n0.577125\n-1.931522\n\n\n\n\n5 rows × 53 columns\n\n\n\n\nM_metabolic_genes_clr_pd.head(5)\n\n\n\n\n\n\n\n\n4cl\n4hbd\na3galt2\na4galt\naaat\naacs\naadat\naae7\naanat\naao\n...\nyrrt\nysaa\nyvgn\nyvof\nywte\nyxei\nzadh2\nzds\nzep\nzwf\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n1.544808\n-4.437793\n-2.415370\n-4.437793\n-4.437793\n-4.437793\n-4.437793\n-4.437793\n-0.967927\n2.192661\n...\n0.748551\n1.458401\n0.476037\n-0.493827\n-4.437793\n-4.437793\n-0.934746\n-2.185370\n-4.437793\n4.842259\n\n\nS10_Z01\n1.081652\n-4.485976\n-4.485976\n-4.485976\n-4.485976\n0.095802\n-0.716056\n-0.266439\n-1.053143\n2.993139\n...\n-0.942180\n2.173256\n1.161133\n-0.350640\n-4.485976\n-4.485976\n0.198199\n-4.485976\n-4.485976\n4.448763\n\n\nS10_Z05\n0.939952\n-4.362372\n-4.362372\n-4.362372\n-4.362372\n-0.845973\n-0.104247\n-1.293770\n-4.362372\n2.885096\n...\n-4.362372\n1.897803\n1.528302\n-4.362372\n-0.667678\n-4.362372\n-1.050630\n-4.362372\n-4.362372\n4.369034\n\n\nS11_Z00\n1.159219\n-4.752608\n-4.752608\n-1.202688\n-3.222255\n-4.752608\n-2.758768\n-0.044202\n-1.279417\n3.309934\n...\n-0.565320\n1.129768\n1.157104\n1.181154\n-0.342053\n-4.752608\n-4.752608\n-4.752608\n-4.752608\n4.252462\n\n\nS11_Z01\n1.344209\n-4.551753\n-0.496556\n-4.551753\n-4.551753\n-1.379482\n0.144414\n-0.436744\n-1.703418\n1.547420\n...\n-0.532901\n1.470423\n1.144608\n-1.038643\n-4.551753\n-4.551753\n0.918399\n-4.551753\n-4.551753\n4.311860\n\n\n\n\n5 rows × 3730 columns\n\n\n\n\nM_taxa_order_clr_pd.head(5)\n\n\n\n\n\n\n\n\nPlanctomycetales\nDehalococcoidales\nNitrospinales\nChromatiales\nOceanospirillales\nAlteromonadales\nVibrionales\nMamiellales\nBacillales\nCellvibrionales\n...\nNitrospinae order incertae sedis\nOpitutae order incertae sedis\nPlanctomycetes order incertae sedis\nPlanctomycetia order incertae sedis\nProteobacteria order incertae sedis\nThaumarchaeota order incertae sedis\nUnknown cellular organism order incertae sedis\nVerrucomicrobia order incertae sedis\nVerrucomicrobiae order incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n-0.321200\n-1.168218\n-4.213022\n-0.451820\n-1.728113\n1.146954\n-3.114407\n1.334109\n-4.213022\n2.629130\n...\n0.501005\n-0.425177\n-0.731780\n-1.168218\n3.161094\n0.581567\n-1.168218\n2.389526\n-1.168218\n5.846828\n\n\nS10_Z01\n0.350818\n-2.380552\n-2.613646\n0.146364\n-1.971792\n-2.208181\n-4.223087\n0.845821\n-3.529936\n2.225014\n...\n1.545237\n-1.910548\n-0.095949\n-1.059240\n2.827131\n2.255719\n-1.059240\n2.017064\n-4.223087\n6.035370\n\n\nS10_Z05\n-0.350825\n-0.919264\n-0.128106\n-0.092649\n0.066175\n1.704923\n-3.510374\n-2.257612\n-2.950760\n0.310896\n...\n1.783090\n-3.104911\n-0.984647\n-1.387885\n1.899399\n4.263271\n-1.387885\n1.649054\n-1.712155\n5.748310\n\n\nS11_Z00\n1.594692\n-0.576208\n-2.442570\n0.701582\n-1.972566\n-0.639761\n-2.953396\n0.127495\n-1.436486\n2.316751\n...\n1.055956\n-2.511562\n0.440367\n-1.436486\n2.772268\n1.861355\n-1.436486\n2.236915\n-0.860161\n5.513756\n\n\nS11_Z01\n1.255168\n-2.508920\n-2.860318\n0.429654\n-1.373940\n-0.899482\n-2.914385\n-0.680793\n-2.760235\n2.240696\n...\n1.958264\n-4.012997\n0.673753\n-1.203684\n2.473719\n2.129210\n-1.203684\n1.873086\n-4.012997\n5.940790\n\n\n\n\n5 rows × 57 columns\n\n\n\n\nM_taxa_phylum_clr_pd.head(5)\n\n\n\n\n\n\n\n\nCyanobacteria\nProteobacteria\nFirmicutes\nNitrospinae\nGemmatimonadetes\nBalneolaeota\nChloroflexi\nActinobacteria\nPlanctomycetes\nEuryarchaeota\nChlorophyta\nAcidobacteria\nCandidatus Marinimicrobia\nThaumarchaeota\nVerrucomicrobia\nBacteroidetes\nArchaea phylum incertae sedis\nBacteria phylum incertae sedis\nUnknown cellular organism phylum incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n1.879154\n4.604169\n-5.503160\n-0.780205\n-0.358237\n-4.404546\n-3.395704\n-0.968313\n-1.102556\n2.200667\n0.043970\n-0.358237\n-0.358237\n0.830780\n1.472134\n3.637719\n-4.586868\n2.949018\n-0.358237\n4.556689\n\n\nS10_Z01\n1.351233\n4.027963\n-5.310462\n-0.219785\n-0.736533\n-0.736533\n-2.992374\n-0.878580\n-0.935199\n2.450596\n-0.934706\n-0.736533\n-0.736533\n1.651044\n0.671531\n2.776622\n-5.310462\n3.080402\n-0.736533\n4.254844\n\n\nS10_Z05\n-1.179467\n4.130350\n-4.236525\n0.635263\n-2.924338\n-4.796139\n-0.408848\n1.153577\n-1.210956\n1.724460\n-3.543377\n-0.574856\n-0.574856\n3.407938\n0.591682\n2.499350\n-1.474836\n2.893888\n-0.574856\n4.462546\n\n\nS11_Z00\n0.238461\n4.190532\n-5.761163\n-0.217939\n-2.264654\n-0.642312\n-0.082591\n0.889791\n0.565046\n3.070766\n-1.176194\n-3.182892\n-2.218338\n1.326033\n1.147324\n2.683803\n-5.355698\n3.222270\n-0.642312\n4.210067\n\n\nS11_Z01\n0.640929\n3.913169\n-4.527801\n0.198744\n-0.868005\n-0.868005\n-2.446986\n-0.363746\n-0.068285\n1.173275\n-2.448359\n-0.868005\n-0.868005\n1.817057\n0.524087\n2.438963\n-3.834653\n3.150408\n-0.868005\n4.173224\n\n\n\n\n\n\n\nAgregar las matrices transformadas en un solo DataFrame.\n\nM_clr = du.concat_dataframes(\n        M_biogeochemical_genes_clr_pd,\n        M_metabolic_genes_clr_pd,\n        M_taxa_order_clr_pd,\n        M_taxa_phylum_clr_pd,\n)\n\nGuardar todas las matrices transformadas y la matriz agregada en archivos CSV.\n\nCLR_DATA_DIR = \"../data/clr_data/\"\ndu.save_data(M_biogeochemical_genes_clr_pd, CLR_DATA_DIR + \"M_biogeochemical_genes_clr\")\ndu.save_data(M_metabolic_genes_clr_pd, CLR_DATA_DIR + \"M_metabolic_genes_clr\")\ndu.save_data(M_taxa_order_clr_pd, CLR_DATA_DIR + \"M_taxa_order_clr\")\ndu.save_data(M_taxa_phylum_clr_pd, CLR_DATA_DIR + \"M_taxa_phylum_clr\")\ndu.save_data(M_clr, CLR_DATA_DIR + \"M_clr\")"
  },
  {
    "objectID": "reports/clr.html#resumen",
    "href": "reports/clr.html#resumen",
    "title": "CLR Transformation",
    "section": "",
    "text": "En este informe, se detalla el proceso de transformación CLR (Centered Log-Ratio) aplicado a las multiples matrices ómicas.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.data_normalization as dn\n\nDefinir el directorio de datos procesados y cargar las matrices ómicas.\n\nDATA_PROCESSED_DIR = \"../data/processed_data/\"\nM_biogeochemical_genes_pd = du.load_data(\n    DATA_PROCESSED_DIR + \"M_biogeochemical_genes\", index_col=0\n)\nM_metabolic_genes_pd = du.load_data(\n    DATA_PROCESSED_DIR + \"M_metabolic_genes\", index_col=0\n)\nM_taxa_order_pd = du.load_data(DATA_PROCESSED_DIR + \"M_taxa_order\", index_col=0)\nM_taxa_phylum_pd = du.load_data(DATA_PROCESSED_DIR + \"M_taxa_phylum\", index_col=0)\n\nExplorar ordenes de las matrices cargadas.\n\nM_biogeochemical_genes_pd.head(5)\n\n\n\n\n\n\n\n\nabfd\nacs\nacsb\napca\napcf\napra\naprb\ncoxl\ncoxm\ncoxs\n...\npeth\nprkb\npsaa\npsba\npufm\nrbcl\nrbcs\nsat\nsir\nsuox\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n359.26500\n160.26942\n13.03536\n551.80506\n503.93206\n31.17031\n2745.90727\n2193.68913\n2646.25809\n1990.82600\n...\n753.12482\n578.64676\n751.26299\n391.39658\n1211.17597\n263.23020\n601.13471\n1899.31977\n1748.68208\n30.37250\n\n\nS10_Z01\n13.43326\n104.11034\n15.99147\n376.32500\n576.59155\n3.81675\n3808.86923\n1847.60399\n2872.41969\n1779.57401\n...\n494.64409\n535.00770\n667.16508\n613.87983\n693.63110\n267.17403\n696.82120\n3360.56333\n1381.66879\n20.22587\n\n\nS10_Z05\n207.26238\n10.41636\n6.92328\n29.61720\n40.69934\n17.56785\n3565.34567\n2312.78238\n3963.81748\n1847.62309\n...\n30.93330\n178.00411\n43.85765\n12.39310\n117.83646\n39.76609\n29.51159\n4566.57900\n132.59523\n7.31381\n\n\nS11_Z00\n957.36366\n63.35688\n0.00000\n142.09083\n136.29833\n165.22989\n3635.90066\n1791.71607\n2556.46020\n1899.38764\n...\n213.32369\n229.89671\n290.87010\n284.08304\n396.60838\n185.10762\n185.63410\n2347.31152\n275.83163\n24.20977\n\n\nS11_Z01\n658.82872\n75.84249\n30.12646\n295.28445\n243.31355\n21.16518\n3570.86447\n1663.07110\n3296.77196\n1519.42635\n...\n416.76124\n352.35362\n336.44839\n414.26516\n490.55923\n188.88768\n319.24680\n3085.04002\n406.79209\n33.10402\n\n\n\n\n5 rows × 53 columns\n\n\n\n\nM_metabolic_genes_pd.head(5)\n\n\n\n\n\n\n\n\n4cl\n4hbd\na3galt2\na4galt\naaat\naacs\naadat\naae7\naanat\naao\n...\nyrrt\nysaa\nyvgn\nyvof\nywte\nyxei\nzadh2\nzds\nzep\nzwf\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n166.18297\n0.0\n3.1674\n0.000\n0.00000\n0.00000\n0.00000\n0.00000\n13.46850\n317.64736\n...\n74.9508\n152.42642\n57.07226\n21.63806\n0.0000\n0.0\n13.92290\n3.98649\n0.0\n4494.18542\n\n\nS10_Z01\n107.94783\n0.0\n0.0000\n0.000\n0.00000\n40.27773\n17.88460\n28.03790\n12.76687\n730.06630\n...\n14.2651\n321.58204\n116.87789\n25.77375\n0.0000\n0.0\n44.62057\n0.00000\n0.0\n3129.90803\n\n\nS10_Z05\n58.20414\n0.0\n0.0000\n0.000\n0.00000\n9.75746\n20.48633\n6.23535\n0.00000\n407.11690\n...\n0.0000\n151.68520\n104.82646\n0.00000\n11.6619\n0.0\n7.95161\n0.00000\n0.0\n1795.49998\n\n\nS11_Z00\n130.01854\n0.0\n0.0000\n12.253\n1.62613\n0.00000\n2.58491\n39.02711\n11.34800\n1116.99000\n...\n23.1765\n126.24522\n129.74392\n132.90209\n28.9742\n0.0\n0.00000\n0.00000\n0.0\n2866.70927\n\n\nS11_Z01\n112.42628\n0.0\n17.8416\n0.000\n0.00000\n7.37877\n33.86910\n18.94130\n5.33704\n137.75942\n...\n17.2048\n127.55050\n92.08360\n10.37549\n0.0000\n0.0\n73.44145\n0.00000\n0.0\n2186.26235\n\n\n\n\n5 rows × 3821 columns\n\n\n\n\nM_taxa_order_pd.head(5)\n\n\n\n\n\n\n\n\nNitrososphaerales\nChthonomonadales\nBacteroidetes Order II. Incertae sedis\nChroococcales\nPlanctomycetales\nCandidatus Brocadiales\nDesulfurococcales\nOscillatoriales\nNostocales\nDeinococcales\n...\nUnknown cellular organism order incertae sedis\nVerrucomicrobia order incertae sedis\nVerrucomicrobiae order incertae sedis\nZetaproteobacteria order incertae sedis\ncandidate division CPR3 order incertae sedis\ncandidate division NC10 order incertae sedis\ncandidate division WOR-3 order incertae sedis\ncandidate division WWE3 order incertae sedis\ncandidate division Zixibacteria order incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n0.0\n0.0\n0.0\n0.0\n0.000721\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.010844\n0.000000\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.344094\n\n\nS10_Z01\n0.0\n0.0\n0.0\n0.0\n0.001265\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006697\n0.000013\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.372401\n\n\nS10_Z05\n0.0\n0.0\n0.0\n0.0\n0.000871\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006435\n0.000223\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.387987\n\n\nS11_Z00\n0.0\n0.0\n0.0\n0.0\n0.006389\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.012144\n0.000549\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.321720\n\n\nS11_Z01\n0.0\n0.0\n0.0\n0.0\n0.003610\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006698\n0.000019\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.391293\n\n\n\n\n5 rows × 406 columns\n\n\n\n\nM_taxa_phylum_pd.head(5)\n\n\n\n\n\n\n\n\nChlorobi\nCyanobacteria\nIgnavibacteriae\nProteobacteria\nFirmicutes\nNitrospinae\nDeinococcus-Thermus\nKiritimatiellaeota\ncandidate division Zixibacteria\nGemmatimonadetes\n...\nBacteria phylum [Chlorobi/Ignavibacteriae]\nBacteria phylum [Firmicutes/Actinobacteria]\nBacteria phylum [Nitrospirae/Bacteroidetes]\nBacteria phylum [Proteobacteria/Actinobacteria]\nBacteria phylum [Proteobacteria/Armatimonadetes]\nBacteria phylum [Proteobacteria/Chloroflexi]\nBacteria phylum [Proteobacteria/Firmicutes]\nBacteria phylum incertae sedis\nUnknown cellular organism phylum incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n0.0\n0.023650\n0.0\n0.360825\n0.000015\n0.001655\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.068940\n0.0\n0.344094\n\n\nS10_Z01\n0.0\n0.020417\n0.0\n0.296810\n0.000026\n0.004243\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.115069\n0.0\n0.372401\n\n\nS10_Z05\n0.0\n0.001376\n0.0\n0.278321\n0.000065\n0.008446\n0.0\n0.0\n0.0\n0.000240\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.080827\n0.0\n0.387987\n\n\nS11_Z00\n0.0\n0.006062\n0.0\n0.315496\n0.000015\n0.003841\n0.0\n0.0\n0.0\n0.000496\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.119807\n0.0\n0.321720\n\n\nS11_Z01\n0.0\n0.011441\n0.0\n0.301691\n0.000065\n0.007352\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.140701\n0.0\n0.391293\n\n\n\n\n5 rows × 145 columns\n\n\n\nAplicar la transformación CLR a cada una de las matrices ómicas.\n\nM_biogeochemical_genes_clr_pd = dn.clr_transform(\n    M_biogeochemical_genes_pd, min_prevalence=0.01, min_variance=1e-4\n)[0]\nM_metabolic_genes_clr_pd = dn.clr_transform(\n    M_metabolic_genes_pd, min_prevalence=0.01, min_variance=1e-4\n)[0]\nM_taxa_order_clr_pd = dn.clr_transform(\n    M_taxa_order_pd, min_prevalence=1e-8, min_variance=1e-8\n)[0]\nM_taxa_phylum_clr_pd = dn.clr_transform(\n    M_taxa_phylum_pd, min_prevalence=1e-8, min_variance=1e-8\n)[0]\n\nExplorar las matrices transformadas.\n\nM_biogeochemical_genes_clr_pd.head(5)\n\n\n\n\n\n\n\n\nabfd\nacs\nacsb\napca\napcf\napra\naprb\ncoxl\ncoxm\ncoxs\n...\npeth\nprkb\npsaa\npsba\npufm\nrbcl\nrbcs\nsat\nsir\nsuox\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n0.156263\n-0.650941\n-3.160131\n0.585398\n0.494645\n-2.288331\n2.190070\n1.965543\n2.153105\n1.868508\n...\n0.896434\n0.632895\n0.893959\n0.241925\n1.371550\n-0.154768\n0.671022\n1.821454\n1.738821\n-2.314259\n\n\nS10_Z01\n-2.928854\n-0.881137\n-2.754532\n0.403865\n0.830546\n-4.187189\n2.718500\n1.995057\n2.436322\n1.957541\n...\n0.677251\n0.755693\n0.976450\n0.893211\n1.015352\n0.061312\n1.019941\n2.593276\n1.704459\n-2.519625\n\n\nS10_Z05\n0.520668\n-2.469940\n-2.878428\n-1.424962\n-1.107106\n-1.947247\n3.365699\n2.932889\n3.471645\n2.708338\n...\n-1.381484\n0.368489\n-1.032369\n-2.296178\n-0.044020\n-1.130303\n-1.428535\n3.613202\n0.073983\n-2.823553\n\n\nS11_Z00\n1.360033\n-1.355367\n-2.563941\n-0.547684\n-0.589304\n-0.396813\n2.694462\n1.986779\n2.342228\n2.045136\n...\n-0.141340\n-0.066520\n0.168726\n0.145116\n0.478799\n-0.283213\n-0.280373\n2.256875\n0.115640\n-2.317394\n\n\nS11_Z01\n1.059287\n-1.102518\n-2.025773\n0.256762\n0.063174\n-2.378819\n2.749386\n1.985244\n2.669522\n1.894911\n...\n0.601337\n0.433458\n0.387268\n0.595329\n0.764369\n-0.190024\n0.334788\n2.603143\n0.577125\n-1.931522\n\n\n\n\n5 rows × 53 columns\n\n\n\n\nM_metabolic_genes_clr_pd.head(5)\n\n\n\n\n\n\n\n\n4cl\n4hbd\na3galt2\na4galt\naaat\naacs\naadat\naae7\naanat\naao\n...\nyrrt\nysaa\nyvgn\nyvof\nywte\nyxei\nzadh2\nzds\nzep\nzwf\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n1.544808\n-4.437793\n-2.415370\n-4.437793\n-4.437793\n-4.437793\n-4.437793\n-4.437793\n-0.967927\n2.192661\n...\n0.748551\n1.458401\n0.476037\n-0.493827\n-4.437793\n-4.437793\n-0.934746\n-2.185370\n-4.437793\n4.842259\n\n\nS10_Z01\n1.081652\n-4.485976\n-4.485976\n-4.485976\n-4.485976\n0.095802\n-0.716056\n-0.266439\n-1.053143\n2.993139\n...\n-0.942180\n2.173256\n1.161133\n-0.350640\n-4.485976\n-4.485976\n0.198199\n-4.485976\n-4.485976\n4.448763\n\n\nS10_Z05\n0.939952\n-4.362372\n-4.362372\n-4.362372\n-4.362372\n-0.845973\n-0.104247\n-1.293770\n-4.362372\n2.885096\n...\n-4.362372\n1.897803\n1.528302\n-4.362372\n-0.667678\n-4.362372\n-1.050630\n-4.362372\n-4.362372\n4.369034\n\n\nS11_Z00\n1.159219\n-4.752608\n-4.752608\n-1.202688\n-3.222255\n-4.752608\n-2.758768\n-0.044202\n-1.279417\n3.309934\n...\n-0.565320\n1.129768\n1.157104\n1.181154\n-0.342053\n-4.752608\n-4.752608\n-4.752608\n-4.752608\n4.252462\n\n\nS11_Z01\n1.344209\n-4.551753\n-0.496556\n-4.551753\n-4.551753\n-1.379482\n0.144414\n-0.436744\n-1.703418\n1.547420\n...\n-0.532901\n1.470423\n1.144608\n-1.038643\n-4.551753\n-4.551753\n0.918399\n-4.551753\n-4.551753\n4.311860\n\n\n\n\n5 rows × 3730 columns\n\n\n\n\nM_taxa_order_clr_pd.head(5)\n\n\n\n\n\n\n\n\nPlanctomycetales\nDehalococcoidales\nNitrospinales\nChromatiales\nOceanospirillales\nAlteromonadales\nVibrionales\nMamiellales\nBacillales\nCellvibrionales\n...\nNitrospinae order incertae sedis\nOpitutae order incertae sedis\nPlanctomycetes order incertae sedis\nPlanctomycetia order incertae sedis\nProteobacteria order incertae sedis\nThaumarchaeota order incertae sedis\nUnknown cellular organism order incertae sedis\nVerrucomicrobia order incertae sedis\nVerrucomicrobiae order incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n-0.321200\n-1.168218\n-4.213022\n-0.451820\n-1.728113\n1.146954\n-3.114407\n1.334109\n-4.213022\n2.629130\n...\n0.501005\n-0.425177\n-0.731780\n-1.168218\n3.161094\n0.581567\n-1.168218\n2.389526\n-1.168218\n5.846828\n\n\nS10_Z01\n0.350818\n-2.380552\n-2.613646\n0.146364\n-1.971792\n-2.208181\n-4.223087\n0.845821\n-3.529936\n2.225014\n...\n1.545237\n-1.910548\n-0.095949\n-1.059240\n2.827131\n2.255719\n-1.059240\n2.017064\n-4.223087\n6.035370\n\n\nS10_Z05\n-0.350825\n-0.919264\n-0.128106\n-0.092649\n0.066175\n1.704923\n-3.510374\n-2.257612\n-2.950760\n0.310896\n...\n1.783090\n-3.104911\n-0.984647\n-1.387885\n1.899399\n4.263271\n-1.387885\n1.649054\n-1.712155\n5.748310\n\n\nS11_Z00\n1.594692\n-0.576208\n-2.442570\n0.701582\n-1.972566\n-0.639761\n-2.953396\n0.127495\n-1.436486\n2.316751\n...\n1.055956\n-2.511562\n0.440367\n-1.436486\n2.772268\n1.861355\n-1.436486\n2.236915\n-0.860161\n5.513756\n\n\nS11_Z01\n1.255168\n-2.508920\n-2.860318\n0.429654\n-1.373940\n-0.899482\n-2.914385\n-0.680793\n-2.760235\n2.240696\n...\n1.958264\n-4.012997\n0.673753\n-1.203684\n2.473719\n2.129210\n-1.203684\n1.873086\n-4.012997\n5.940790\n\n\n\n\n5 rows × 57 columns\n\n\n\n\nM_taxa_phylum_clr_pd.head(5)\n\n\n\n\n\n\n\n\nCyanobacteria\nProteobacteria\nFirmicutes\nNitrospinae\nGemmatimonadetes\nBalneolaeota\nChloroflexi\nActinobacteria\nPlanctomycetes\nEuryarchaeota\nChlorophyta\nAcidobacteria\nCandidatus Marinimicrobia\nThaumarchaeota\nVerrucomicrobia\nBacteroidetes\nArchaea phylum incertae sedis\nBacteria phylum incertae sedis\nUnknown cellular organism phylum incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n1.879154\n4.604169\n-5.503160\n-0.780205\n-0.358237\n-4.404546\n-3.395704\n-0.968313\n-1.102556\n2.200667\n0.043970\n-0.358237\n-0.358237\n0.830780\n1.472134\n3.637719\n-4.586868\n2.949018\n-0.358237\n4.556689\n\n\nS10_Z01\n1.351233\n4.027963\n-5.310462\n-0.219785\n-0.736533\n-0.736533\n-2.992374\n-0.878580\n-0.935199\n2.450596\n-0.934706\n-0.736533\n-0.736533\n1.651044\n0.671531\n2.776622\n-5.310462\n3.080402\n-0.736533\n4.254844\n\n\nS10_Z05\n-1.179467\n4.130350\n-4.236525\n0.635263\n-2.924338\n-4.796139\n-0.408848\n1.153577\n-1.210956\n1.724460\n-3.543377\n-0.574856\n-0.574856\n3.407938\n0.591682\n2.499350\n-1.474836\n2.893888\n-0.574856\n4.462546\n\n\nS11_Z00\n0.238461\n4.190532\n-5.761163\n-0.217939\n-2.264654\n-0.642312\n-0.082591\n0.889791\n0.565046\n3.070766\n-1.176194\n-3.182892\n-2.218338\n1.326033\n1.147324\n2.683803\n-5.355698\n3.222270\n-0.642312\n4.210067\n\n\nS11_Z01\n0.640929\n3.913169\n-4.527801\n0.198744\n-0.868005\n-0.868005\n-2.446986\n-0.363746\n-0.068285\n1.173275\n-2.448359\n-0.868005\n-0.868005\n1.817057\n0.524087\n2.438963\n-3.834653\n3.150408\n-0.868005\n4.173224\n\n\n\n\n\n\n\nAgregar las matrices transformadas en un solo DataFrame.\n\nM_clr = du.concat_dataframes(\n        M_biogeochemical_genes_clr_pd,\n        M_metabolic_genes_clr_pd,\n        M_taxa_order_clr_pd,\n        M_taxa_phylum_clr_pd,\n)\n\nGuardar todas las matrices transformadas y la matriz agregada en archivos CSV.\n\nCLR_DATA_DIR = \"../data/clr_data/\"\ndu.save_data(M_biogeochemical_genes_clr_pd, CLR_DATA_DIR + \"M_biogeochemical_genes_clr\")\ndu.save_data(M_metabolic_genes_clr_pd, CLR_DATA_DIR + \"M_metabolic_genes_clr\")\ndu.save_data(M_taxa_order_clr_pd, CLR_DATA_DIR + \"M_taxa_order_clr\")\ndu.save_data(M_taxa_phylum_clr_pd, CLR_DATA_DIR + \"M_taxa_phylum_clr\")\ndu.save_data(M_clr, CLR_DATA_DIR + \"M_clr\")"
  },
  {
    "objectID": "reports/metadata_pipeline.html",
    "href": "reports/metadata_pipeline.html",
    "title": "Metadata Pipeline",
    "section": "",
    "text": "En este informe, se detalla el proceso de carga y análisis inicial de los conjuntos de metadatos utilizados en el proyecto.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport src.data_utils as du\n\nDefinir los nombres de los archivos de metadatos, su columna de índices y su extensión.\n\nMETADATA_RAW_DIR = \"raw_metadata/\"\n\nmetadata_cast_BGC_file_name = METADATA_RAW_DIR + \"Metadata_cast_BGC_raw\"\nindex_col = None\nmetadata_cast_BGC_file_extension = \"csv\"\n\nmetadata_geographic_coordinates_file_name = (\n    METADATA_RAW_DIR + \"Metadata_geographic_coordinates_raw\"\n)\nindex_col = None\nmetadata_environmental_file_extension = \"csv\"\n\nCargar los metadatos en dataframes de pandas.\n\nMetadata_cast_BGC_raw_pd = du.load_data(\n    metadata_cast_BGC_file_name,\n    index_col,\n    metadata_cast_BGC_file_extension,\n)\n\nMetadata_geographic_coordinates_raw_pd = du.load_data(\n    metadata_geographic_coordinates_file_name,\n    index_col,\n    metadata_environmental_file_extension,\n)\n\nPrimer análisis de los metadatos cargados, mostrando la forma de los dataframes y algunas de sus filas.\n\nprint(\"Metadata cast BGC shape: \", str(Metadata_cast_BGC_raw_pd.shape))\nMetadata_cast_BGC_raw_pd.head(5)\n\nMetadata cast BGC shape:  (159, 35)\n\n\n\n\n\n\n\n\n\nSample ID\nSAMEA ID\nLeg\nStation\nDepth ID\nDepth [m]\nTemperature [ºC]\nSalinity [PSU]\nDensity [kg/m3]\nOxygen [ml/l]\n...\nsecond\nlon_cast\nlat_cast\nDepth level\nOxygen level\nBiogeographical units\nFreshwater inputs\nDistance from coast (km)\nOxy_depth\nOxy_Simple\n\n\n\n\n0\nS1_Z00\nSAMEA7920473\n1\n1\nZ0\n2\n11,272\n24,72\n1018,754\n6,665\n...\n52\n-74,27833\n-50,89833\nSRF\nOXIC\nPFR\nEW\n6,8\nSRF\nOXIC\n\n\n1\nS1_Z01\nSAMEA7920507\n1\n1\nZ1\n20\n10,569\n29,59\n1022,730\n5,856\n...\n52\n-74,27833\n-50,89833\nEPI\nOXIC\nPFR\nEW\n6,8\nOxic EPI\nOXIC\n\n\n2\nS1_Z05\nSAMEA7920503\n1\n1\nZ5\n90\n9,060\n32,820\n1025,818\n4,836\n...\n52\n-74,27833\n-50,89833\nEPI\nOXIC\nPFR\nSW\n6,8\nOxic EPI\nOXIC\n\n\n3\nS2_Z00\nSAMEA7920664\n1\n2\nZ0\n2\n11,465\n26,58\n1020,165\n6,430\n...\n1\n-74,57333\n-50,70167\nSRF\nOXIC\nPFR\nEW\n36,0\nSRF\nOXIC\n\n\n4\nS2_Z01\nSAMEA7920687\n1\n2\nZ1\n10\n11,426\n26,774\n1020,357\n6,413\n...\n1\n-74,57333\n-50,70167\nEPI\nOXIC\nPFR\nEW\n36,0\nOxic EPI\nOXIC\n\n\n\n\n5 rows × 35 columns\n\n\n\n\ncolumns_names_object_cast_BGC = du.get_column_names_and_object_types(\n    Metadata_cast_BGC_raw_pd\n)\ncolumns_names_object_cast_BGC\n\n\n\n\n\n\n\n\ncolumn_name\nobject_type\n\n\n\n\n0\nSample ID\nobject\n\n\n1\nSAMEA ID\nobject\n\n\n2\nLeg\nint64\n\n\n3\nStation\nint64\n\n\n4\nDepth ID\nobject\n\n\n5\nDepth [m]\nint64\n\n\n6\nTemperature [ºC]\nobject\n\n\n7\nSalinity [PSU]\nobject\n\n\n8\nDensity [kg/m3]\nobject\n\n\n9\nOxygen [ml/l]\nobject\n\n\n10\nOxygen [%]\nobject\n\n\n11\nFluorescence [mg/m3]\nobject\n\n\n12\nOrthophosphate [uM]\nobject\n\n\n13\nSilicic acid [uM]\nobject\n\n\n14\nNitrite [uM]\nobject\n\n\n15\nNitrates [uM]\nobject\n\n\n16\nNitrate [uM]\nobject\n\n\n17\nN/P ratio\nobject\n\n\n18\nNitrous oxide [nM]\nobject\n\n\n19\ndatetime\nobject\n\n\n20\nyear\nint64\n\n\n21\nmonth\nint64\n\n\n22\nday\nint64\n\n\n23\nhour\nint64\n\n\n24\nminute\nint64\n\n\n25\nsecond\nint64\n\n\n26\nlon_cast\nobject\n\n\n27\nlat_cast\nobject\n\n\n28\nDepth level\nobject\n\n\n29\nOxygen level\nobject\n\n\n30\nBiogeographical units\nobject\n\n\n31\nFreshwater inputs\nobject\n\n\n32\nDistance from coast (km)\nobject\n\n\n33\nOxy_depth\nobject\n\n\n34\nOxy_Simple\nobject\n\n\n\n\n\n\n\n\nprint(\"Metadata geographic coordinates shape: \", str(Metadata_geographic_coordinates_raw_pd.shape))\nMetadata_geographic_coordinates_raw_pd.head(5)\n\nMetadata geographic coordinates shape:  (63, 9)\n\n\n\n\n\n\n\n\n\nMission\nLeg\nStation\nLongitude\nLatitude\nDate (yyyymmdd)\nUTM zone\nLongitude (m E)\nLatitude (m S)\n\n\n\n\n0\nTARA Chile\n1\nS1\n-74,27833333\n-50,89833333\n20210220\n18F\n550749,372988242\n4361231,71498109\n\n\n1\nTARA Chile\n1\nS2\n-74,57333333\n-50,70166667\n20210222\n18F\n530130,558455499\n4383262,24904219\n\n\n2\nTARA Chile\n1\nS3\n-74.801\n-50,657\n20210224\n18F\n530700,010000000\n4391801,36000000\n\n\n3\nTARA Chile\n1\nS4\n-75,015\n-50,50183333\n20210228\n18F\n498936,225247974\n4405569,65544054\n\n\n4\nTARA Chile\n1\nS5\n-75,83807222\n-50,4693\n20210226\n18F\n440524,907623883\n4408851,77184951\n\n\n\n\n\n\n\n\ncolumns_names_object_geographic_coordinates = du.get_column_names_and_object_types(\n    Metadata_geographic_coordinates_raw_pd\n)\ncolumns_names_object_geographic_coordinates\n\n\n\n\n\n\n\n\ncolumn_name\nobject_type\n\n\n\n\n0\nMission\nobject\n\n\n1\nLeg\nint64\n\n\n2\nStation\nobject\n\n\n3\nLongitude\nobject\n\n\n4\nLatitude\nobject\n\n\n5\nDate (yyyymmdd)\nobject\n\n\n6\nUTM zone\nobject\n\n\n7\nLongitude (m E)\nobject\n\n\n8\nLatitude (m S)\nobject\n\n\n\n\n\n\n\nEliminar columnas irrelevantes si es necesario.\n\nMetadata_cast_BGC_raw_pd.drop(\n    columns=[\"SAMEA ID\", \"Depth ID\", \"datetime\", \"lon_cast\", \"lat_cast\"], inplace=True\n)\nMetadata_geographic_coordinates_raw_pd.drop(\n    columns=[\"Mission\", \"Date (yyyymmdd)\"], inplace=True\n)\n\nEncontrar valores faltantes en los metadatos.\n\nmissing_cast_BGC = du.check_missing_values(Metadata_cast_BGC_raw_pd)\nprint(\"Missing values in Metadata cast BGC:\\n\", missing_cast_BGC)\n\nMissing values in Metadata cast BGC:\n Sample ID                    0\nLeg                          0\nStation                      0\nDepth [m]                    0\nTemperature [ºC]             0\nSalinity [PSU]               0\nDensity [kg/m3]              0\nOxygen [ml/l]                0\nOxygen [%]                   0\nFluorescence [mg/m3]         0\nOrthophosphate [uM]          0\nSilicic acid [uM]            0\nNitrite [uM]                 0\nNitrates  [uM]               0\nNitrate [uM]                 0\nN/P ratio                    0\nNitrous oxide [nM]          68\nyear                         0\nmonth                        0\nday                          0\nhour                         0\nminute                       0\nsecond                       0\nDepth level                  0\nOxygen level                 0\nBiogeographical units        0\nFreshwater inputs            0\nDistance from coast (km)     0\nOxy_depth                    0\nOxy_Simple                   0\ndtype: int64\n\n\n\nmissing_geographic_coordinates = du.check_missing_values(\n    Metadata_geographic_coordinates_raw_pd\n)\nprint(\n    \"Missing values in Metadata geographic coordinates:\\n\",\n    missing_geographic_coordinates,\n)\n\nMissing values in Metadata geographic coordinates:\n Leg                0\nStation            0\nLongitude          0\nLatitude           0\nUTM zone           0\nLongitude (m E)    0\nLatitude (m S)     0\ndtype: int64\n\n\nEliminar columnas con valores faltantes si es necesario.\n\nMetadata_cast_BGC_raw_pd.drop(columns=[\"Nitrous oxide [nM]\"], inplace=True)\n\nRenombrar columnas para mayor claridad si es necesario.\n\nMetadata_cast_BGC_raw_pd.columns = Metadata_cast_BGC_raw_pd.columns.str.lower()\nMetadata_geographic_coordinates_raw_pd.columns = Metadata_geographic_coordinates_raw_pd.columns.str.lower()\n\n\nrename_columns_dict_cast_bgc = {\n    \"sample id\": \"sample_id\",\n    \"depth [m]\": \"depth_m\",\n    \"temperature [ºc]\": \"temperature_[c]\",\n    \"salinity [psu] \": \"salinity_[psu]\",\n    \"density [kg/m3]\": \"density_[kg/m3]\",\n    \"oxygen [ml/l]\": \"oxygen_[ml/l]\",\n    \"oxygen [%]\": \"oxygen_[%]\",\n    \"fluorescence [mg/m3]\": \"fluorescence_[mg/m3]\",\n    \"orthophosphate [um]\": \"orthophosphate_[um]\",\n    \"silicic acid [um]\": \"silicic_acid_[um]\",\n    \"nitrite [um]\": \"nitrite_[um]\",\n    \"nitrates  [um]\": \"nitrates_[um]\",\n    \"nitrate [um]\": \"nitrate_[um]\",\n    \"n/p ratio\": \"n_p_ratio\",\n    \"nitrous oxide [nm]\": \"nitrous_oxide_[nm]\",\n    \"datetime\": \"datetime\",\n    \"year\": \"year\",\n    \"month\": \"month\",\n    \"day\": \"day\",\n    \"hour\": \"hour\",\n    \"minute\": \"minute\",\n    \"second\": \"second\",\n    \"depth level\": \"depth_level\",\n    \"oxygen level\": \"oxygen_level\",\n    \"biogeographical units\": \"biogeographical_units\",\n    \"freshwater inputs\": \"freshwater_inputs\",\n    \"distance from coast (km)\": \"distance_from_coast_[km]\",\n    \"oxy_depth\": \"oxy_depth\",\n    \"oxy_simple\": \"oxy_simple\",\n}\nMetadata_cast_BGC_raw_pd.rename(columns=rename_columns_dict_cast_bgc, inplace=True)\n\n\nrename_columns_dict_geographic_coordinates = {\n    \"longitude\": \"longitude\",\n    \"latitude\": \"latitude\",\n    \"utm zone\": \"utm_zone\",\n    \"longitude (m e)\": \"longitude_[m_e]\",\n    \"latitude (m s)\": \"latitude_[m_s]\",\n}\n\nMetadata_geographic_coordinates_raw_pd.rename(\n    columns=rename_columns_dict_geographic_coordinates, inplace=True\n)\n\nArreglar formatos de columnas que tienen ‘,’ en lugar de ‘.’ como separador decimal.\n\ncolumns_to_transform_cast_BGC = [\n    col for col in Metadata_cast_BGC_raw_pd.columns if col.endswith(\"]\")\n]\nMetadata_cast_BGC_raw_pd = du.replace_comas_with_dots(\n    Metadata_cast_BGC_raw_pd, columns_to_transform_cast_BGC\n)\n\n\ncolumns_to_transform_coordinates = Metadata_geographic_coordinates_raw_pd.select_dtypes(\n    include=[\"object\"]\n).columns\ncolumns_to_transform_coordinates = [\n    col\n    for col in columns_to_transform_coordinates\n    if col not in [\"utm_zone\", \"station\"]\n]\nMetadata_geographic_coordinates_raw_pd = du.replace_comas_with_dots(\n    Metadata_geographic_coordinates_raw_pd, columns_to_transform_coordinates\n)\n\nGuardar los metadatos procesados para su uso posterior.\n\nMETADATA_PROCESSED_DIR = \"processed_metadata/\"\ndu.save_data(\n    Metadata_cast_BGC_raw_pd, METADATA_PROCESSED_DIR + \"Metadata_cast_BGC_processed\"\n)\ndu.save_data(\n    Metadata_geographic_coordinates_raw_pd,\n    METADATA_PROCESSED_DIR + \"Metadata_geographic_coordinates_processed\",\n)\n\nAgregar metadatos en una única tabla.\n\nMetadata_aggregated_pd = Metadata_cast_BGC_raw_pd.copy()\nfor index, row in Metadata_aggregated_pd.iterrows():\n    station = row[\"sample_id\"].split(\"_\")[0]\n    matching_geo_data = Metadata_geographic_coordinates_raw_pd[\n        Metadata_geographic_coordinates_raw_pd[\"station\"] == station\n    ]\n    if not matching_geo_data.empty:\n        for col in matching_geo_data.columns:\n            Metadata_aggregated_pd.at[index, col] = matching_geo_data.iloc[0][col]\n\n/tmp/ipykernel_398624/1677386544.py:9: FutureWarning:\n\nSetting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value 'S1' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.\n\n\n\nGuardar los metadatos agregados.\n\ndu.save_data(Metadata_aggregated_pd, METADATA_PROCESSED_DIR + \"Metadata_aggregated\")"
  },
  {
    "objectID": "reports/metadata_pipeline.html#resumen",
    "href": "reports/metadata_pipeline.html#resumen",
    "title": "Metadata Pipeline",
    "section": "",
    "text": "En este informe, se detalla el proceso de carga y análisis inicial de los conjuntos de metadatos utilizados en el proyecto.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport src.data_utils as du\n\nDefinir los nombres de los archivos de metadatos, su columna de índices y su extensión.\n\nMETADATA_RAW_DIR = \"raw_metadata/\"\n\nmetadata_cast_BGC_file_name = METADATA_RAW_DIR + \"Metadata_cast_BGC_raw\"\nindex_col = None\nmetadata_cast_BGC_file_extension = \"csv\"\n\nmetadata_geographic_coordinates_file_name = (\n    METADATA_RAW_DIR + \"Metadata_geographic_coordinates_raw\"\n)\nindex_col = None\nmetadata_environmental_file_extension = \"csv\"\n\nCargar los metadatos en dataframes de pandas.\n\nMetadata_cast_BGC_raw_pd = du.load_data(\n    metadata_cast_BGC_file_name,\n    index_col,\n    metadata_cast_BGC_file_extension,\n)\n\nMetadata_geographic_coordinates_raw_pd = du.load_data(\n    metadata_geographic_coordinates_file_name,\n    index_col,\n    metadata_environmental_file_extension,\n)\n\nPrimer análisis de los metadatos cargados, mostrando la forma de los dataframes y algunas de sus filas.\n\nprint(\"Metadata cast BGC shape: \", str(Metadata_cast_BGC_raw_pd.shape))\nMetadata_cast_BGC_raw_pd.head(5)\n\nMetadata cast BGC shape:  (159, 35)\n\n\n\n\n\n\n\n\n\nSample ID\nSAMEA ID\nLeg\nStation\nDepth ID\nDepth [m]\nTemperature [ºC]\nSalinity [PSU]\nDensity [kg/m3]\nOxygen [ml/l]\n...\nsecond\nlon_cast\nlat_cast\nDepth level\nOxygen level\nBiogeographical units\nFreshwater inputs\nDistance from coast (km)\nOxy_depth\nOxy_Simple\n\n\n\n\n0\nS1_Z00\nSAMEA7920473\n1\n1\nZ0\n2\n11,272\n24,72\n1018,754\n6,665\n...\n52\n-74,27833\n-50,89833\nSRF\nOXIC\nPFR\nEW\n6,8\nSRF\nOXIC\n\n\n1\nS1_Z01\nSAMEA7920507\n1\n1\nZ1\n20\n10,569\n29,59\n1022,730\n5,856\n...\n52\n-74,27833\n-50,89833\nEPI\nOXIC\nPFR\nEW\n6,8\nOxic EPI\nOXIC\n\n\n2\nS1_Z05\nSAMEA7920503\n1\n1\nZ5\n90\n9,060\n32,820\n1025,818\n4,836\n...\n52\n-74,27833\n-50,89833\nEPI\nOXIC\nPFR\nSW\n6,8\nOxic EPI\nOXIC\n\n\n3\nS2_Z00\nSAMEA7920664\n1\n2\nZ0\n2\n11,465\n26,58\n1020,165\n6,430\n...\n1\n-74,57333\n-50,70167\nSRF\nOXIC\nPFR\nEW\n36,0\nSRF\nOXIC\n\n\n4\nS2_Z01\nSAMEA7920687\n1\n2\nZ1\n10\n11,426\n26,774\n1020,357\n6,413\n...\n1\n-74,57333\n-50,70167\nEPI\nOXIC\nPFR\nEW\n36,0\nOxic EPI\nOXIC\n\n\n\n\n5 rows × 35 columns\n\n\n\n\ncolumns_names_object_cast_BGC = du.get_column_names_and_object_types(\n    Metadata_cast_BGC_raw_pd\n)\ncolumns_names_object_cast_BGC\n\n\n\n\n\n\n\n\ncolumn_name\nobject_type\n\n\n\n\n0\nSample ID\nobject\n\n\n1\nSAMEA ID\nobject\n\n\n2\nLeg\nint64\n\n\n3\nStation\nint64\n\n\n4\nDepth ID\nobject\n\n\n5\nDepth [m]\nint64\n\n\n6\nTemperature [ºC]\nobject\n\n\n7\nSalinity [PSU]\nobject\n\n\n8\nDensity [kg/m3]\nobject\n\n\n9\nOxygen [ml/l]\nobject\n\n\n10\nOxygen [%]\nobject\n\n\n11\nFluorescence [mg/m3]\nobject\n\n\n12\nOrthophosphate [uM]\nobject\n\n\n13\nSilicic acid [uM]\nobject\n\n\n14\nNitrite [uM]\nobject\n\n\n15\nNitrates [uM]\nobject\n\n\n16\nNitrate [uM]\nobject\n\n\n17\nN/P ratio\nobject\n\n\n18\nNitrous oxide [nM]\nobject\n\n\n19\ndatetime\nobject\n\n\n20\nyear\nint64\n\n\n21\nmonth\nint64\n\n\n22\nday\nint64\n\n\n23\nhour\nint64\n\n\n24\nminute\nint64\n\n\n25\nsecond\nint64\n\n\n26\nlon_cast\nobject\n\n\n27\nlat_cast\nobject\n\n\n28\nDepth level\nobject\n\n\n29\nOxygen level\nobject\n\n\n30\nBiogeographical units\nobject\n\n\n31\nFreshwater inputs\nobject\n\n\n32\nDistance from coast (km)\nobject\n\n\n33\nOxy_depth\nobject\n\n\n34\nOxy_Simple\nobject\n\n\n\n\n\n\n\n\nprint(\"Metadata geographic coordinates shape: \", str(Metadata_geographic_coordinates_raw_pd.shape))\nMetadata_geographic_coordinates_raw_pd.head(5)\n\nMetadata geographic coordinates shape:  (63, 9)\n\n\n\n\n\n\n\n\n\nMission\nLeg\nStation\nLongitude\nLatitude\nDate (yyyymmdd)\nUTM zone\nLongitude (m E)\nLatitude (m S)\n\n\n\n\n0\nTARA Chile\n1\nS1\n-74,27833333\n-50,89833333\n20210220\n18F\n550749,372988242\n4361231,71498109\n\n\n1\nTARA Chile\n1\nS2\n-74,57333333\n-50,70166667\n20210222\n18F\n530130,558455499\n4383262,24904219\n\n\n2\nTARA Chile\n1\nS3\n-74.801\n-50,657\n20210224\n18F\n530700,010000000\n4391801,36000000\n\n\n3\nTARA Chile\n1\nS4\n-75,015\n-50,50183333\n20210228\n18F\n498936,225247974\n4405569,65544054\n\n\n4\nTARA Chile\n1\nS5\n-75,83807222\n-50,4693\n20210226\n18F\n440524,907623883\n4408851,77184951\n\n\n\n\n\n\n\n\ncolumns_names_object_geographic_coordinates = du.get_column_names_and_object_types(\n    Metadata_geographic_coordinates_raw_pd\n)\ncolumns_names_object_geographic_coordinates\n\n\n\n\n\n\n\n\ncolumn_name\nobject_type\n\n\n\n\n0\nMission\nobject\n\n\n1\nLeg\nint64\n\n\n2\nStation\nobject\n\n\n3\nLongitude\nobject\n\n\n4\nLatitude\nobject\n\n\n5\nDate (yyyymmdd)\nobject\n\n\n6\nUTM zone\nobject\n\n\n7\nLongitude (m E)\nobject\n\n\n8\nLatitude (m S)\nobject\n\n\n\n\n\n\n\nEliminar columnas irrelevantes si es necesario.\n\nMetadata_cast_BGC_raw_pd.drop(\n    columns=[\"SAMEA ID\", \"Depth ID\", \"datetime\", \"lon_cast\", \"lat_cast\"], inplace=True\n)\nMetadata_geographic_coordinates_raw_pd.drop(\n    columns=[\"Mission\", \"Date (yyyymmdd)\"], inplace=True\n)\n\nEncontrar valores faltantes en los metadatos.\n\nmissing_cast_BGC = du.check_missing_values(Metadata_cast_BGC_raw_pd)\nprint(\"Missing values in Metadata cast BGC:\\n\", missing_cast_BGC)\n\nMissing values in Metadata cast BGC:\n Sample ID                    0\nLeg                          0\nStation                      0\nDepth [m]                    0\nTemperature [ºC]             0\nSalinity [PSU]               0\nDensity [kg/m3]              0\nOxygen [ml/l]                0\nOxygen [%]                   0\nFluorescence [mg/m3]         0\nOrthophosphate [uM]          0\nSilicic acid [uM]            0\nNitrite [uM]                 0\nNitrates  [uM]               0\nNitrate [uM]                 0\nN/P ratio                    0\nNitrous oxide [nM]          68\nyear                         0\nmonth                        0\nday                          0\nhour                         0\nminute                       0\nsecond                       0\nDepth level                  0\nOxygen level                 0\nBiogeographical units        0\nFreshwater inputs            0\nDistance from coast (km)     0\nOxy_depth                    0\nOxy_Simple                   0\ndtype: int64\n\n\n\nmissing_geographic_coordinates = du.check_missing_values(\n    Metadata_geographic_coordinates_raw_pd\n)\nprint(\n    \"Missing values in Metadata geographic coordinates:\\n\",\n    missing_geographic_coordinates,\n)\n\nMissing values in Metadata geographic coordinates:\n Leg                0\nStation            0\nLongitude          0\nLatitude           0\nUTM zone           0\nLongitude (m E)    0\nLatitude (m S)     0\ndtype: int64\n\n\nEliminar columnas con valores faltantes si es necesario.\n\nMetadata_cast_BGC_raw_pd.drop(columns=[\"Nitrous oxide [nM]\"], inplace=True)\n\nRenombrar columnas para mayor claridad si es necesario.\n\nMetadata_cast_BGC_raw_pd.columns = Metadata_cast_BGC_raw_pd.columns.str.lower()\nMetadata_geographic_coordinates_raw_pd.columns = Metadata_geographic_coordinates_raw_pd.columns.str.lower()\n\n\nrename_columns_dict_cast_bgc = {\n    \"sample id\": \"sample_id\",\n    \"depth [m]\": \"depth_m\",\n    \"temperature [ºc]\": \"temperature_[c]\",\n    \"salinity [psu] \": \"salinity_[psu]\",\n    \"density [kg/m3]\": \"density_[kg/m3]\",\n    \"oxygen [ml/l]\": \"oxygen_[ml/l]\",\n    \"oxygen [%]\": \"oxygen_[%]\",\n    \"fluorescence [mg/m3]\": \"fluorescence_[mg/m3]\",\n    \"orthophosphate [um]\": \"orthophosphate_[um]\",\n    \"silicic acid [um]\": \"silicic_acid_[um]\",\n    \"nitrite [um]\": \"nitrite_[um]\",\n    \"nitrates  [um]\": \"nitrates_[um]\",\n    \"nitrate [um]\": \"nitrate_[um]\",\n    \"n/p ratio\": \"n_p_ratio\",\n    \"nitrous oxide [nm]\": \"nitrous_oxide_[nm]\",\n    \"datetime\": \"datetime\",\n    \"year\": \"year\",\n    \"month\": \"month\",\n    \"day\": \"day\",\n    \"hour\": \"hour\",\n    \"minute\": \"minute\",\n    \"second\": \"second\",\n    \"depth level\": \"depth_level\",\n    \"oxygen level\": \"oxygen_level\",\n    \"biogeographical units\": \"biogeographical_units\",\n    \"freshwater inputs\": \"freshwater_inputs\",\n    \"distance from coast (km)\": \"distance_from_coast_[km]\",\n    \"oxy_depth\": \"oxy_depth\",\n    \"oxy_simple\": \"oxy_simple\",\n}\nMetadata_cast_BGC_raw_pd.rename(columns=rename_columns_dict_cast_bgc, inplace=True)\n\n\nrename_columns_dict_geographic_coordinates = {\n    \"longitude\": \"longitude\",\n    \"latitude\": \"latitude\",\n    \"utm zone\": \"utm_zone\",\n    \"longitude (m e)\": \"longitude_[m_e]\",\n    \"latitude (m s)\": \"latitude_[m_s]\",\n}\n\nMetadata_geographic_coordinates_raw_pd.rename(\n    columns=rename_columns_dict_geographic_coordinates, inplace=True\n)\n\nArreglar formatos de columnas que tienen ‘,’ en lugar de ‘.’ como separador decimal.\n\ncolumns_to_transform_cast_BGC = [\n    col for col in Metadata_cast_BGC_raw_pd.columns if col.endswith(\"]\")\n]\nMetadata_cast_BGC_raw_pd = du.replace_comas_with_dots(\n    Metadata_cast_BGC_raw_pd, columns_to_transform_cast_BGC\n)\n\n\ncolumns_to_transform_coordinates = Metadata_geographic_coordinates_raw_pd.select_dtypes(\n    include=[\"object\"]\n).columns\ncolumns_to_transform_coordinates = [\n    col\n    for col in columns_to_transform_coordinates\n    if col not in [\"utm_zone\", \"station\"]\n]\nMetadata_geographic_coordinates_raw_pd = du.replace_comas_with_dots(\n    Metadata_geographic_coordinates_raw_pd, columns_to_transform_coordinates\n)\n\nGuardar los metadatos procesados para su uso posterior.\n\nMETADATA_PROCESSED_DIR = \"processed_metadata/\"\ndu.save_data(\n    Metadata_cast_BGC_raw_pd, METADATA_PROCESSED_DIR + \"Metadata_cast_BGC_processed\"\n)\ndu.save_data(\n    Metadata_geographic_coordinates_raw_pd,\n    METADATA_PROCESSED_DIR + \"Metadata_geographic_coordinates_processed\",\n)\n\nAgregar metadatos en una única tabla.\n\nMetadata_aggregated_pd = Metadata_cast_BGC_raw_pd.copy()\nfor index, row in Metadata_aggregated_pd.iterrows():\n    station = row[\"sample_id\"].split(\"_\")[0]\n    matching_geo_data = Metadata_geographic_coordinates_raw_pd[\n        Metadata_geographic_coordinates_raw_pd[\"station\"] == station\n    ]\n    if not matching_geo_data.empty:\n        for col in matching_geo_data.columns:\n            Metadata_aggregated_pd.at[index, col] = matching_geo_data.iloc[0][col]\n\n/tmp/ipykernel_398624/1677386544.py:9: FutureWarning:\n\nSetting an item of incompatible dtype is deprecated and will raise an error in a future version of pandas. Value 'S1' has dtype incompatible with int64, please explicitly cast to a compatible dtype first.\n\n\n\nGuardar los metadatos agregados.\n\ndu.save_data(Metadata_aggregated_pd, METADATA_PROCESSED_DIR + \"Metadata_aggregated\")"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Integración de datos “ómicos” del océano costero chileno con la ayuda de aprendizaje de máquinas",
    "section": "",
    "text": "Data Pipeline\n\n\n\n\n\n\n\n\n\n\n\n\n\nMetadata Pipeline\n\n\n\n\n\n\n\n\n\n\n\n\n\nMetadata Exploratory Data Analysis\n\n\n\n\n\n\n\n\n\n\n\n\n\nCLR Transformation\n\n\n\n\n\n\n\n\n\n\n\n\n\nPCA\n\n\n\n\n\n\n\n\n\n\n\n\n\nMOFA\n\n\n\n\n\n\n\n\n\n\n\n\n\nUMAP Analysis\n\n\n\n\n\n\n\n\n\n\n\n\n\nMOFA & PCA analysis\n\n\n\n\n\n\n\n\n\n\n\n\n\nClustering Execution & Optimization\n\n\n\n\n\n\n\n\n\n\n\n\n\nCluster Interpretation & Analysis\n\n\n\n\n\n\n\n\n\n\n\n\n\nPareto Task Inference Analysis\n\n\n\n\n\n\n\n\n\n\n\n\n\nMetadata prediction Analysis\n\n\n\n\n\n\n\n\n\n\n\nNo matching items"
  },
  {
    "objectID": "reports/data_pipeline.html",
    "href": "reports/data_pipeline.html",
    "title": "Data Pipeline",
    "section": "",
    "text": "En este informe, se detalla el proceso de carga y análisis inicial de los conjuntos de datos principales utilizados en el proyecto.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport src.data_utils as du\n\nDefinir los nombres de los archivos de datos, su columna de índices y su extensión.\n\nDATA_RAW_DIR = \"raw_data/\"\n\nbiogeochemical_genes_file_name = DATA_RAW_DIR + \"M_biogeochemical_genes_raw\"\nbiogeochemical_genes_index_col = \"TSC\"\nbiogeochemical_genes_file_extension = \"tsv\"\n\nmetabolic_genes_file_name = DATA_RAW_DIR + \"M_metabolic_genes_raw\"\nmetabolic_genes_index_col = \"TSC\"\nmetabolic_genes_file_extension = \"tsv\"\n\ntaxa_order_file_name = DATA_RAW_DIR + \"M_taxa_order_raw\"\ntaxa_order_index_col = \"Taxonomy\"\ntaxa_order_file_extension = \"tsv\"\n\ntaxa_phylum_file_name = DATA_RAW_DIR + \"M_taxa_phylum_raw\"\ntaxa_phylum_index_col = \"Taxonomy\"\ntaxa_phylum_file_extension = \"tsv\"\n\nCargar los datos en dataframes de pandas.\n\nM_biogeochemical_genes_raw_pd = du.load_data(\n    biogeochemical_genes_file_name,\n    biogeochemical_genes_index_col,\n    biogeochemical_genes_file_extension,\n)\n\nM_metabolic_genes_raw_pd = du.load_data(\n    metabolic_genes_file_name, metabolic_genes_index_col, metabolic_genes_file_extension\n)\n\nM_taxa_order_pd = du.load_data(\n    taxa_order_file_name, taxa_order_index_col, taxa_order_file_extension\n).T\n\nM_taxa_phylum_pd = du.load_data(\n    taxa_phylum_file_name, taxa_phylum_index_col, taxa_phylum_file_extension\n).T\n\nPrimer análisis de los datos cargados, mostrando la forma de los dataframes y algunas de sus filas.\n\nprint(\"Biogeochemical genes shape: \", str(M_biogeochemical_genes_raw_pd.shape))\nM_biogeochemical_genes_raw_pd.head(5)\n\nBiogeochemical genes shape:  (159, 53)\n\n\n\n\n\n\n\n\n\nabfd\nacs\nacsb\napca\napcf\napra\naprb\ncoxl\ncoxm\ncoxs\n...\npeth\nprkb\npsaa\npsba\npufm\nrbcl\nrbcs\nsat\nsir\nsuox\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n359.26500\n160.26942\n13.03536\n551.80506\n503.93206\n31.17031\n2745.90727\n2193.68913\n2646.25809\n1990.82600\n...\n753.12482\n578.64676\n751.26299\n391.39658\n1211.17597\n263.23020\n601.13471\n1899.31977\n1748.68208\n30.37250\n\n\nS10_Z01\n13.43326\n104.11034\n15.99147\n376.32500\n576.59155\n3.81675\n3808.86923\n1847.60399\n2872.41969\n1779.57401\n...\n494.64409\n535.00770\n667.16508\n613.87983\n693.63110\n267.17403\n696.82120\n3360.56333\n1381.66879\n20.22587\n\n\nS10_Z05\n207.26238\n10.41636\n6.92328\n29.61720\n40.69934\n17.56785\n3565.34567\n2312.78238\n3963.81748\n1847.62309\n...\n30.93330\n178.00411\n43.85765\n12.39310\n117.83646\n39.76609\n29.51159\n4566.57900\n132.59523\n7.31381\n\n\nS11_Z00\n957.36366\n63.35688\n0.00000\n142.09083\n136.29833\n165.22989\n3635.90066\n1791.71607\n2556.46020\n1899.38764\n...\n213.32369\n229.89671\n290.87010\n284.08304\n396.60838\n185.10762\n185.63410\n2347.31152\n275.83163\n24.20977\n\n\nS11_Z01\n658.82872\n75.84249\n30.12646\n295.28445\n243.31355\n21.16518\n3570.86447\n1663.07110\n3296.77196\n1519.42635\n...\n416.76124\n352.35362\n336.44839\n414.26516\n490.55923\n188.88768\n319.24680\n3085.04002\n406.79209\n33.10402\n\n\n\n\n5 rows × 53 columns\n\n\n\n\nprint(\"Metabolic genes shape: \", str(M_metabolic_genes_raw_pd.shape))\nM_metabolic_genes_raw_pd.head(5)\n\nMetabolic genes shape:  (159, 3821)\n\n\n\n\n\n\n\n\n\n4cl\n4hbd\na3galt2\na4galt\naaat\naacs\naadat\naae7\naanat\naao\n...\nyrrt\nysaa\nyvgn\nyvof\nywte\nyxei\nzadh2\nzds\nzep\nzwf\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n166.18297\n0.0\n3.1674\n0.000\n0.00000\n0.00000\n0.00000\n0.00000\n13.46850\n317.64736\n...\n74.9508\n152.42642\n57.07226\n21.63806\n0.0000\n0.0\n13.92290\n3.98649\n0.0\n4494.18542\n\n\nS10_Z01\n107.94783\n0.0\n0.0000\n0.000\n0.00000\n40.27773\n17.88460\n28.03790\n12.76687\n730.06630\n...\n14.2651\n321.58204\n116.87789\n25.77375\n0.0000\n0.0\n44.62057\n0.00000\n0.0\n3129.90803\n\n\nS10_Z05\n58.20414\n0.0\n0.0000\n0.000\n0.00000\n9.75746\n20.48633\n6.23535\n0.00000\n407.11690\n...\n0.0000\n151.68520\n104.82646\n0.00000\n11.6619\n0.0\n7.95161\n0.00000\n0.0\n1795.49998\n\n\nS11_Z00\n130.01854\n0.0\n0.0000\n12.253\n1.62613\n0.00000\n2.58491\n39.02711\n11.34800\n1116.99000\n...\n23.1765\n126.24522\n129.74392\n132.90209\n28.9742\n0.0\n0.00000\n0.00000\n0.0\n2866.70927\n\n\nS11_Z01\n112.42628\n0.0\n17.8416\n0.000\n0.00000\n7.37877\n33.86910\n18.94130\n5.33704\n137.75942\n...\n17.2048\n127.55050\n92.08360\n10.37549\n0.0000\n0.0\n73.44145\n0.00000\n0.0\n2186.26235\n\n\n\n\n5 rows × 3821 columns\n\n\n\n\nprint(\"Taxa order shape: \", str(M_taxa_order_pd.shape))\nM_taxa_order_pd.head(5)\n\nTaxa order shape:  (159, 406)\n\n\n\n\n\n\n\n\nTaxonomy\nNitrososphaerales\nChthonomonadales\nBacteroidetes Order II. Incertae sedis\nChroococcales\nPlanctomycetales\nCandidatus Brocadiales\nDesulfurococcales\nOscillatoriales\nNostocales\nDeinococcales\n...\nUnknown cellular organism order incertae sedis\nVerrucomicrobia order incertae sedis\nVerrucomicrobiae order incertae sedis\nZetaproteobacteria order incertae sedis\ncandidate division CPR3 order incertae sedis\ncandidate division NC10 order incertae sedis\ncandidate division WOR-3 order incertae sedis\ncandidate division WWE3 order incertae sedis\ncandidate division Zixibacteria order incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n0.0\n0.0\n0.0\n0.0\n0.000721\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.010844\n0.000000\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.344094\n\n\nS10_Z01\n0.0\n0.0\n0.0\n0.0\n0.001265\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006697\n0.000013\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.372401\n\n\nS10_Z05\n0.0\n0.0\n0.0\n0.0\n0.000871\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006435\n0.000223\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.387987\n\n\nS11_Z00\n0.0\n0.0\n0.0\n0.0\n0.006389\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.012144\n0.000549\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.321720\n\n\nS11_Z01\n0.0\n0.0\n0.0\n0.0\n0.003610\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006698\n0.000019\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.391293\n\n\n\n\n5 rows × 406 columns\n\n\n\n\nprint(\"Taxa phylum shape: \", str(M_taxa_phylum_pd.shape))\nM_taxa_phylum_pd.head(5)\n\nTaxa phylum shape:  (159, 145)\n\n\n\n\n\n\n\n\nTaxonomy\nChlorobi\nCyanobacteria\nIgnavibacteriae\nProteobacteria\nFirmicutes\nNitrospinae\nDeinococcus-Thermus\nKiritimatiellaeota\ncandidate division Zixibacteria\nGemmatimonadetes\n...\nBacteria phylum [Chlorobi/Ignavibacteriae]\nBacteria phylum [Firmicutes/Actinobacteria]\nBacteria phylum [Nitrospirae/Bacteroidetes]\nBacteria phylum [Proteobacteria/Actinobacteria]\nBacteria phylum [Proteobacteria/Armatimonadetes]\nBacteria phylum [Proteobacteria/Chloroflexi]\nBacteria phylum [Proteobacteria/Firmicutes]\nBacteria phylum incertae sedis\nUnknown cellular organism phylum incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n0.0\n0.023650\n0.0\n0.360825\n0.000015\n0.001655\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.068940\n0.0\n0.344094\n\n\nS10_Z01\n0.0\n0.020417\n0.0\n0.296810\n0.000026\n0.004243\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.115069\n0.0\n0.372401\n\n\nS10_Z05\n0.0\n0.001376\n0.0\n0.278321\n0.000065\n0.008446\n0.0\n0.0\n0.0\n0.000240\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.080827\n0.0\n0.387987\n\n\nS11_Z00\n0.0\n0.006062\n0.0\n0.315496\n0.000015\n0.003841\n0.0\n0.0\n0.0\n0.000496\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.119807\n0.0\n0.321720\n\n\nS11_Z01\n0.0\n0.011441\n0.0\n0.301691\n0.000065\n0.007352\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.140701\n0.0\n0.391293\n\n\n\n\n5 rows × 145 columns\n\n\n\nGuardar los dataframes como archivos CSV para su uso posterior.\n\nDATA_PROCESSED_DIR = \"processed_data/\"\ndu.save_data(\n    M_biogeochemical_genes_raw_pd, DATA_PROCESSED_DIR + \"M_biogeochemical_genes\"\n)\ndu.save_data(M_metabolic_genes_raw_pd, DATA_PROCESSED_DIR + \"M_metabolic_genes\")\ndu.save_data(M_taxa_order_pd, DATA_PROCESSED_DIR + \"M_taxa_order\")\ndu.save_data(M_taxa_phylum_pd, DATA_PROCESSED_DIR + \"M_taxa_phylum\")"
  },
  {
    "objectID": "reports/data_pipeline.html#resumen",
    "href": "reports/data_pipeline.html#resumen",
    "title": "Data Pipeline",
    "section": "",
    "text": "En este informe, se detalla el proceso de carga y análisis inicial de los conjuntos de datos principales utilizados en el proyecto.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport src.data_utils as du\n\nDefinir los nombres de los archivos de datos, su columna de índices y su extensión.\n\nDATA_RAW_DIR = \"raw_data/\"\n\nbiogeochemical_genes_file_name = DATA_RAW_DIR + \"M_biogeochemical_genes_raw\"\nbiogeochemical_genes_index_col = \"TSC\"\nbiogeochemical_genes_file_extension = \"tsv\"\n\nmetabolic_genes_file_name = DATA_RAW_DIR + \"M_metabolic_genes_raw\"\nmetabolic_genes_index_col = \"TSC\"\nmetabolic_genes_file_extension = \"tsv\"\n\ntaxa_order_file_name = DATA_RAW_DIR + \"M_taxa_order_raw\"\ntaxa_order_index_col = \"Taxonomy\"\ntaxa_order_file_extension = \"tsv\"\n\ntaxa_phylum_file_name = DATA_RAW_DIR + \"M_taxa_phylum_raw\"\ntaxa_phylum_index_col = \"Taxonomy\"\ntaxa_phylum_file_extension = \"tsv\"\n\nCargar los datos en dataframes de pandas.\n\nM_biogeochemical_genes_raw_pd = du.load_data(\n    biogeochemical_genes_file_name,\n    biogeochemical_genes_index_col,\n    biogeochemical_genes_file_extension,\n)\n\nM_metabolic_genes_raw_pd = du.load_data(\n    metabolic_genes_file_name, metabolic_genes_index_col, metabolic_genes_file_extension\n)\n\nM_taxa_order_pd = du.load_data(\n    taxa_order_file_name, taxa_order_index_col, taxa_order_file_extension\n).T\n\nM_taxa_phylum_pd = du.load_data(\n    taxa_phylum_file_name, taxa_phylum_index_col, taxa_phylum_file_extension\n).T\n\nPrimer análisis de los datos cargados, mostrando la forma de los dataframes y algunas de sus filas.\n\nprint(\"Biogeochemical genes shape: \", str(M_biogeochemical_genes_raw_pd.shape))\nM_biogeochemical_genes_raw_pd.head(5)\n\nBiogeochemical genes shape:  (159, 53)\n\n\n\n\n\n\n\n\n\nabfd\nacs\nacsb\napca\napcf\napra\naprb\ncoxl\ncoxm\ncoxs\n...\npeth\nprkb\npsaa\npsba\npufm\nrbcl\nrbcs\nsat\nsir\nsuox\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n359.26500\n160.26942\n13.03536\n551.80506\n503.93206\n31.17031\n2745.90727\n2193.68913\n2646.25809\n1990.82600\n...\n753.12482\n578.64676\n751.26299\n391.39658\n1211.17597\n263.23020\n601.13471\n1899.31977\n1748.68208\n30.37250\n\n\nS10_Z01\n13.43326\n104.11034\n15.99147\n376.32500\n576.59155\n3.81675\n3808.86923\n1847.60399\n2872.41969\n1779.57401\n...\n494.64409\n535.00770\n667.16508\n613.87983\n693.63110\n267.17403\n696.82120\n3360.56333\n1381.66879\n20.22587\n\n\nS10_Z05\n207.26238\n10.41636\n6.92328\n29.61720\n40.69934\n17.56785\n3565.34567\n2312.78238\n3963.81748\n1847.62309\n...\n30.93330\n178.00411\n43.85765\n12.39310\n117.83646\n39.76609\n29.51159\n4566.57900\n132.59523\n7.31381\n\n\nS11_Z00\n957.36366\n63.35688\n0.00000\n142.09083\n136.29833\n165.22989\n3635.90066\n1791.71607\n2556.46020\n1899.38764\n...\n213.32369\n229.89671\n290.87010\n284.08304\n396.60838\n185.10762\n185.63410\n2347.31152\n275.83163\n24.20977\n\n\nS11_Z01\n658.82872\n75.84249\n30.12646\n295.28445\n243.31355\n21.16518\n3570.86447\n1663.07110\n3296.77196\n1519.42635\n...\n416.76124\n352.35362\n336.44839\n414.26516\n490.55923\n188.88768\n319.24680\n3085.04002\n406.79209\n33.10402\n\n\n\n\n5 rows × 53 columns\n\n\n\n\nprint(\"Metabolic genes shape: \", str(M_metabolic_genes_raw_pd.shape))\nM_metabolic_genes_raw_pd.head(5)\n\nMetabolic genes shape:  (159, 3821)\n\n\n\n\n\n\n\n\n\n4cl\n4hbd\na3galt2\na4galt\naaat\naacs\naadat\naae7\naanat\naao\n...\nyrrt\nysaa\nyvgn\nyvof\nywte\nyxei\nzadh2\nzds\nzep\nzwf\n\n\nTSC\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nS10_Z00\n166.18297\n0.0\n3.1674\n0.000\n0.00000\n0.00000\n0.00000\n0.00000\n13.46850\n317.64736\n...\n74.9508\n152.42642\n57.07226\n21.63806\n0.0000\n0.0\n13.92290\n3.98649\n0.0\n4494.18542\n\n\nS10_Z01\n107.94783\n0.0\n0.0000\n0.000\n0.00000\n40.27773\n17.88460\n28.03790\n12.76687\n730.06630\n...\n14.2651\n321.58204\n116.87789\n25.77375\n0.0000\n0.0\n44.62057\n0.00000\n0.0\n3129.90803\n\n\nS10_Z05\n58.20414\n0.0\n0.0000\n0.000\n0.00000\n9.75746\n20.48633\n6.23535\n0.00000\n407.11690\n...\n0.0000\n151.68520\n104.82646\n0.00000\n11.6619\n0.0\n7.95161\n0.00000\n0.0\n1795.49998\n\n\nS11_Z00\n130.01854\n0.0\n0.0000\n12.253\n1.62613\n0.00000\n2.58491\n39.02711\n11.34800\n1116.99000\n...\n23.1765\n126.24522\n129.74392\n132.90209\n28.9742\n0.0\n0.00000\n0.00000\n0.0\n2866.70927\n\n\nS11_Z01\n112.42628\n0.0\n17.8416\n0.000\n0.00000\n7.37877\n33.86910\n18.94130\n5.33704\n137.75942\n...\n17.2048\n127.55050\n92.08360\n10.37549\n0.0000\n0.0\n73.44145\n0.00000\n0.0\n2186.26235\n\n\n\n\n5 rows × 3821 columns\n\n\n\n\nprint(\"Taxa order shape: \", str(M_taxa_order_pd.shape))\nM_taxa_order_pd.head(5)\n\nTaxa order shape:  (159, 406)\n\n\n\n\n\n\n\n\nTaxonomy\nNitrososphaerales\nChthonomonadales\nBacteroidetes Order II. Incertae sedis\nChroococcales\nPlanctomycetales\nCandidatus Brocadiales\nDesulfurococcales\nOscillatoriales\nNostocales\nDeinococcales\n...\nUnknown cellular organism order incertae sedis\nVerrucomicrobia order incertae sedis\nVerrucomicrobiae order incertae sedis\nZetaproteobacteria order incertae sedis\ncandidate division CPR3 order incertae sedis\ncandidate division NC10 order incertae sedis\ncandidate division WOR-3 order incertae sedis\ncandidate division WWE3 order incertae sedis\ncandidate division Zixibacteria order incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n0.0\n0.0\n0.0\n0.0\n0.000721\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.010844\n0.000000\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.344094\n\n\nS10_Z01\n0.0\n0.0\n0.0\n0.0\n0.001265\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006697\n0.000013\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.372401\n\n\nS10_Z05\n0.0\n0.0\n0.0\n0.0\n0.000871\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006435\n0.000223\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.387987\n\n\nS11_Z00\n0.0\n0.0\n0.0\n0.0\n0.006389\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.012144\n0.000549\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.321720\n\n\nS11_Z01\n0.0\n0.0\n0.0\n0.0\n0.003610\n0.0\n0.0\n0.0\n0.0\n0.0\n...\n0.0\n0.006698\n0.000019\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.391293\n\n\n\n\n5 rows × 406 columns\n\n\n\n\nprint(\"Taxa phylum shape: \", str(M_taxa_phylum_pd.shape))\nM_taxa_phylum_pd.head(5)\n\nTaxa phylum shape:  (159, 145)\n\n\n\n\n\n\n\n\nTaxonomy\nChlorobi\nCyanobacteria\nIgnavibacteriae\nProteobacteria\nFirmicutes\nNitrospinae\nDeinococcus-Thermus\nKiritimatiellaeota\ncandidate division Zixibacteria\nGemmatimonadetes\n...\nBacteria phylum [Chlorobi/Ignavibacteriae]\nBacteria phylum [Firmicutes/Actinobacteria]\nBacteria phylum [Nitrospirae/Bacteroidetes]\nBacteria phylum [Proteobacteria/Actinobacteria]\nBacteria phylum [Proteobacteria/Armatimonadetes]\nBacteria phylum [Proteobacteria/Chloroflexi]\nBacteria phylum [Proteobacteria/Firmicutes]\nBacteria phylum incertae sedis\nUnknown cellular organism phylum incertae sedis\nunassigned\n\n\n\n\nS10_Z00\n0.0\n0.023650\n0.0\n0.360825\n0.000015\n0.001655\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.068940\n0.0\n0.344094\n\n\nS10_Z01\n0.0\n0.020417\n0.0\n0.296810\n0.000026\n0.004243\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.115069\n0.0\n0.372401\n\n\nS10_Z05\n0.0\n0.001376\n0.0\n0.278321\n0.000065\n0.008446\n0.0\n0.0\n0.0\n0.000240\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.080827\n0.0\n0.387987\n\n\nS11_Z00\n0.0\n0.006062\n0.0\n0.315496\n0.000015\n0.003841\n0.0\n0.0\n0.0\n0.000496\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.119807\n0.0\n0.321720\n\n\nS11_Z01\n0.0\n0.011441\n0.0\n0.301691\n0.000065\n0.007352\n0.0\n0.0\n0.0\n0.000000\n...\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.0\n0.140701\n0.0\n0.391293\n\n\n\n\n5 rows × 145 columns\n\n\n\nGuardar los dataframes como archivos CSV para su uso posterior.\n\nDATA_PROCESSED_DIR = \"processed_data/\"\ndu.save_data(\n    M_biogeochemical_genes_raw_pd, DATA_PROCESSED_DIR + \"M_biogeochemical_genes\"\n)\ndu.save_data(M_metabolic_genes_raw_pd, DATA_PROCESSED_DIR + \"M_metabolic_genes\")\ndu.save_data(M_taxa_order_pd, DATA_PROCESSED_DIR + \"M_taxa_order\")\ndu.save_data(M_taxa_phylum_pd, DATA_PROCESSED_DIR + \"M_taxa_phylum\")"
  },
  {
    "objectID": "reports/metadata_EDA.html",
    "href": "reports/metadata_EDA.html",
    "title": "Metadata Exploratory Data Analysis",
    "section": "",
    "text": "En este informe, se realiza un análisis exploratorio de los metadatos cargados previamente en el proyecto.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport src.data_utils as du\n\nCargar los metadatos en dataframes de pandas.\n\nPROCESSED_METADATA_DIR = \"processed_metadata/\"\nmetadata_aggregated_file_name = PROCESSED_METADATA_DIR + \"Metadata_aggregated\"\nindex_col = 0\nmetadata_aggregated_file_extension = \"csv\"\nMetadata_aggregated_pd = du.load_data(\n    metadata_aggregated_file_name,\n    index_col,\n    metadata_aggregated_file_extension,\n)\n\nDistribución en histograma de las variables numéricas en los metadatos.\n\nMetadata_aggregated_pd.hist(bins=30, figsize=(15, 15))\nplt.suptitle(\"Histograms of Numerical Metadata Variables\")\nplt.show()\n\n\n\n\n\n\n\n\nAnálisis de las variables categóricas en los metadatos.\n\ncategorical_columns = Metadata_aggregated_pd.select_dtypes(include=[\"object\"]).columns\nfor col in categorical_columns:\n    print(f\"Value counts for column '{col}':\")\n    print(Metadata_aggregated_pd[col].value_counts())\n    print(\"\\n\")\n\nValue counts for column 'sample_id':\nsample_id\nS1_Z00     1\nS1_Z01     1\nS1_Z05     1\nS2_Z00     1\nS2_Z01     1\n          ..\nS34_Z01    1\nS34_Z03    1\nS34_Z05    1\nS34_Z07    1\nS34_Z09    1\nName: count, Length: 159, dtype: int64\n\n\nValue counts for column 'station':\nstation\nS5     7\nS34    6\nS32    6\nS33    6\nS30    6\nS29    6\nS28    6\nS31    6\nS27    6\nS26    6\nS25    6\nS24    6\nS20    6\nS19    6\nS18    6\nS17    6\nS16    5\nS15    5\nS14    5\nS13    5\nS3     4\nS7     4\nS2     4\nS11    4\nS9     4\nS8     4\nS21    4\nS1     3\nS4     3\nS10    3\nS12    3\nS6     2\nName: count, dtype: int64\n\n\nValue counts for column 'n_p_ratio':\nn_p_ratio\n10,947    2\n12,131    2\n10,440    2\n11,427    2\n11,432    1\n         ..\n4,896     1\n7,159     1\n4,328     1\n5,811     1\n7,244     1\nName: count, Length: 155, dtype: int64\n\n\nValue counts for column 'depth_level':\ndepth_level\nEPI    87\nMES    42\nSRF    30\nName: count, dtype: int64\n\n\nValue counts for column 'oxygen_level':\noxygen_level\nOXIC         117\nS_HYPOXIA     22\nHYPOXIA       17\nANOXIA         3\nName: count, dtype: int64\n\n\nValue counts for column 'biogeographical units ':\nbiogeographical units \nCUR    64\nSUR    34\nPFR    31\nNUR    30\nName: count, dtype: int64\n\n\nValue counts for column 'freshwater inputs ':\nfreshwater inputs \nSW    146\nEW     13\nName: count, dtype: int64\n\n\nValue counts for column 'oxy_depth':\noxy_depth\nOxic EPI    70\nZMO         44\nSRF         30\nOxic MES    15\nName: count, dtype: int64\n\n\nValue counts for column 'oxy_simple':\noxy_simple\nOXIC    117\nZMO      42\nName: count, dtype: int64\n\n\nValue counts for column 'utm_zone':\nutm_zone\n18H    63\n18G    37\n18F    23\n19K    18\n19H     6\n18J     6\n19J     6\nName: count, dtype: int64"
  },
  {
    "objectID": "reports/metadata_EDA.html#resumen",
    "href": "reports/metadata_EDA.html#resumen",
    "title": "Metadata Exploratory Data Analysis",
    "section": "",
    "text": "En este informe, se realiza un análisis exploratorio de los metadatos cargados previamente en el proyecto.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport src.data_utils as du\n\nCargar los metadatos en dataframes de pandas.\n\nPROCESSED_METADATA_DIR = \"processed_metadata/\"\nmetadata_aggregated_file_name = PROCESSED_METADATA_DIR + \"Metadata_aggregated\"\nindex_col = 0\nmetadata_aggregated_file_extension = \"csv\"\nMetadata_aggregated_pd = du.load_data(\n    metadata_aggregated_file_name,\n    index_col,\n    metadata_aggregated_file_extension,\n)\n\nDistribución en histograma de las variables numéricas en los metadatos.\n\nMetadata_aggregated_pd.hist(bins=30, figsize=(15, 15))\nplt.suptitle(\"Histograms of Numerical Metadata Variables\")\nplt.show()\n\n\n\n\n\n\n\n\nAnálisis de las variables categóricas en los metadatos.\n\ncategorical_columns = Metadata_aggregated_pd.select_dtypes(include=[\"object\"]).columns\nfor col in categorical_columns:\n    print(f\"Value counts for column '{col}':\")\n    print(Metadata_aggregated_pd[col].value_counts())\n    print(\"\\n\")\n\nValue counts for column 'sample_id':\nsample_id\nS1_Z00     1\nS1_Z01     1\nS1_Z05     1\nS2_Z00     1\nS2_Z01     1\n          ..\nS34_Z01    1\nS34_Z03    1\nS34_Z05    1\nS34_Z07    1\nS34_Z09    1\nName: count, Length: 159, dtype: int64\n\n\nValue counts for column 'station':\nstation\nS5     7\nS34    6\nS32    6\nS33    6\nS30    6\nS29    6\nS28    6\nS31    6\nS27    6\nS26    6\nS25    6\nS24    6\nS20    6\nS19    6\nS18    6\nS17    6\nS16    5\nS15    5\nS14    5\nS13    5\nS3     4\nS7     4\nS2     4\nS11    4\nS9     4\nS8     4\nS21    4\nS1     3\nS4     3\nS10    3\nS12    3\nS6     2\nName: count, dtype: int64\n\n\nValue counts for column 'n_p_ratio':\nn_p_ratio\n10,947    2\n12,131    2\n10,440    2\n11,427    2\n11,432    1\n         ..\n4,896     1\n7,159     1\n4,328     1\n5,811     1\n7,244     1\nName: count, Length: 155, dtype: int64\n\n\nValue counts for column 'depth_level':\ndepth_level\nEPI    87\nMES    42\nSRF    30\nName: count, dtype: int64\n\n\nValue counts for column 'oxygen_level':\noxygen_level\nOXIC         117\nS_HYPOXIA     22\nHYPOXIA       17\nANOXIA         3\nName: count, dtype: int64\n\n\nValue counts for column 'biogeographical units ':\nbiogeographical units \nCUR    64\nSUR    34\nPFR    31\nNUR    30\nName: count, dtype: int64\n\n\nValue counts for column 'freshwater inputs ':\nfreshwater inputs \nSW    146\nEW     13\nName: count, dtype: int64\n\n\nValue counts for column 'oxy_depth':\noxy_depth\nOxic EPI    70\nZMO         44\nSRF         30\nOxic MES    15\nName: count, dtype: int64\n\n\nValue counts for column 'oxy_simple':\noxy_simple\nOXIC    117\nZMO      42\nName: count, dtype: int64\n\n\nValue counts for column 'utm_zone':\nutm_zone\n18H    63\n18G    37\n18F    23\n19K    18\n19H     6\n18J     6\n19J     6\nName: count, dtype: int64"
  },
  {
    "objectID": "reports/pca.html",
    "href": "reports/pca.html",
    "title": "PCA",
    "section": "",
    "text": "En este informe, se realiza un análisis de Componentes Principales (PCA) sobre el conjunto de datos agregado.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\n\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nfrom sklearn.decomposition import PCA\nimport matplotlib.pyplot as plt\nimport src.data_utils as du\n\nDefinir el directorio de datos procesados y cargar el conjunto de datos agregado.\n\nCLR_DATA_DIR = \"clr_data/\"\nM_clr = du.load_data(CLR_DATA_DIR + \"M_clr\", index_col=0)\n\nEstudiar cantidad de componentes necesarias para explicar varianza.\n\nN_COMPONENTS = 20\npca = PCA(n_components=N_COMPONENTS)\npca.fit(M_clr)\npca_transformed = pca.transform(M_clr)\npca_dict = dict()\nfor i in range(N_COMPONENTS):\n    pca_dict[i + 1] = pca_transformed[:, : i + 1]\npca_explained_variance = np.cumsum(pca.explained_variance_ratio_)\nplt.figure(figsize=(10, 6))\nplt.plot(pca_dict.keys(), pca_explained_variance, marker=\"o\")\nplt.title(\"PCA Explained Variance\")\nplt.xticks(list(pca_dict.keys()))\nplt.xlabel(\"Number of Components\")\nplt.ylabel(\"Explained Variance\")\nplt.grid()\nplt.show()\n\n\n\n\n\n\n\n\nCrear un DataFrame con los resultados del PCA y guardar los datos.\n\nM_pca_pd = pd.DataFrame(pca_transformed, index=M_clr.index)\nM_pca_pd.columns = [f\"PCA{i + 1}\" for i in range(M_pca_pd.shape[1])]\n\n\nPROCESSED_DATA_DIR = \"processed_data/\"\ndu.save_data(M_pca_pd, PROCESSED_DATA_DIR + \"M_pca\")"
  },
  {
    "objectID": "reports/pca.html#resumen",
    "href": "reports/pca.html#resumen",
    "title": "PCA",
    "section": "",
    "text": "En este informe, se realiza un análisis de Componentes Principales (PCA) sobre el conjunto de datos agregado.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\n\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nfrom sklearn.decomposition import PCA\nimport matplotlib.pyplot as plt\nimport src.data_utils as du\n\nDefinir el directorio de datos procesados y cargar el conjunto de datos agregado.\n\nCLR_DATA_DIR = \"clr_data/\"\nM_clr = du.load_data(CLR_DATA_DIR + \"M_clr\", index_col=0)\n\nEstudiar cantidad de componentes necesarias para explicar varianza.\n\nN_COMPONENTS = 20\npca = PCA(n_components=N_COMPONENTS)\npca.fit(M_clr)\npca_transformed = pca.transform(M_clr)\npca_dict = dict()\nfor i in range(N_COMPONENTS):\n    pca_dict[i + 1] = pca_transformed[:, : i + 1]\npca_explained_variance = np.cumsum(pca.explained_variance_ratio_)\nplt.figure(figsize=(10, 6))\nplt.plot(pca_dict.keys(), pca_explained_variance, marker=\"o\")\nplt.title(\"PCA Explained Variance\")\nplt.xticks(list(pca_dict.keys()))\nplt.xlabel(\"Number of Components\")\nplt.ylabel(\"Explained Variance\")\nplt.grid()\nplt.show()\n\n\n\n\n\n\n\n\nCrear un DataFrame con los resultados del PCA y guardar los datos.\n\nM_pca_pd = pd.DataFrame(pca_transformed, index=M_clr.index)\nM_pca_pd.columns = [f\"PCA{i + 1}\" for i in range(M_pca_pd.shape[1])]\n\n\nPROCESSED_DATA_DIR = \"processed_data/\"\ndu.save_data(M_pca_pd, PROCESSED_DATA_DIR + \"M_pca\")"
  },
  {
    "objectID": "reports/umap.html",
    "href": "reports/umap.html",
    "title": "UMAP Analysis",
    "section": "",
    "text": "En este informe, se aplica UMAP (Uniform Manifold Approximation and Projection) sobre el conjunto de datos agregado (transformado con CLR) para visualizar la estructura global y local de las muestras.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.umap_utils as uu\nimport src.plots as p\n\nImportar datos procesados.\n\nDATA_DIR = \"../data/\"\nCLR_DATA_DIR = DATA_DIR + \"clr_data/\"\nPROCESSED_METADATA_DIR = DATA_DIR + \"processed_metadata/\"\nPROCESSED_DATA_DIR = DATA_DIR + \"processed_data/\"\n\n# Cargar datos ómicos\nm_clr = du.load_data(CLR_DATA_DIR + \"M_clr\", index_col=0)\n\n# Cargar metadatos\nmetadata = du.load_data(PROCESSED_METADATA_DIR + \"Metadata_aggregated\", index_col=0)\n\nEjecutar UMAP sobre los datos CLR agregados.\n\n# Definición de hyperparámetros de UMAP\nn_neighbors = 10\nmin_dist = 0.1\nrandom_state = 97\nn_components = 3\n\n# Ejecutar UMAP\nm_umap = uu.run_umap(\n    m_clr,\n    n_neighbors=n_neighbors,\n    min_dist=min_dist,\n    random_state=random_state,\n    n_components=n_components,\n)\n\n# Guardar resultados\ndu.save_data(m_umap, PROCESSED_DATA_DIR + \"M_umap\")\n\nm_umap.head()\n\n/home/davidnfu0/.conda/envs/Omic_Integration/lib/python3.13/site-packages/umap/umap_.py:1952: UserWarning:\n\nn_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.\n\n\n\n\n\n\n\n\n\n\nUMAP_1\nUMAP_2\nUMAP_3\n\n\n\n\nS10_Z00\n3.008061\n12.104615\n4.211886\n\n\nS10_Z01\n3.353623\n12.191257\n4.169571\n\n\nS10_Z05\n5.812279\n12.092410\n2.699975\n\n\nS11_Z00\n3.822574\n12.323472\n3.502521\n\n\nS11_Z01\n3.721075\n12.002115\n4.032786\n\n\n\n\n\n\n\nAnálisis visual básico de resultados UMAP\n\np.scatter_plot_3d(\n    m_umap[\"UMAP_1\"],\n    m_umap[\"UMAP_2\"],\n    m_umap[\"UMAP_3\"],\n    xlabel=\"UMAP 1\",\n    ylabel=\"UMAP 2\",\n    title=\"UMAP 3D Scatter Plot\",\n    s=40,\n    alpha=0.7,\n)\n\n\n\n\n\n\n\n\nAnálisis de relación entre UMAP y variables de metadatos\n\nnumerical_columns_metadata = metadata.select_dtypes(\n    include=[np.number]\n).columns.tolist()\nnumerical_columns_metadata.remove(\"day\")\nnumerical_columns_metadata.remove(\"hour\")\nnumerical_columns_metadata.remove(\"minute\")\nnumerical_columns_metadata.remove(\"second\")\nnumerical_columns_metadata.remove(\"year\")\nnumerical_columns_metadata.remove(\"month\")\ncolumns_metadata = numerical_columns_metadata\n\np.plot_dim_reduction_metadata(\n    m_umap[\"UMAP_1\"], m_umap[\"UMAP_2\"], metadata, columns_metadata, dim_name=\"UMAP\"\n)"
  },
  {
    "objectID": "reports/umap.html#resumen",
    "href": "reports/umap.html#resumen",
    "title": "UMAP Analysis",
    "section": "",
    "text": "En este informe, se aplica UMAP (Uniform Manifold Approximation and Projection) sobre el conjunto de datos agregado (transformado con CLR) para visualizar la estructura global y local de las muestras.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.umap_utils as uu\nimport src.plots as p\n\nImportar datos procesados.\n\nDATA_DIR = \"../data/\"\nCLR_DATA_DIR = DATA_DIR + \"clr_data/\"\nPROCESSED_METADATA_DIR = DATA_DIR + \"processed_metadata/\"\nPROCESSED_DATA_DIR = DATA_DIR + \"processed_data/\"\n\n# Cargar datos ómicos\nm_clr = du.load_data(CLR_DATA_DIR + \"M_clr\", index_col=0)\n\n# Cargar metadatos\nmetadata = du.load_data(PROCESSED_METADATA_DIR + \"Metadata_aggregated\", index_col=0)\n\nEjecutar UMAP sobre los datos CLR agregados.\n\n# Definición de hyperparámetros de UMAP\nn_neighbors = 10\nmin_dist = 0.1\nrandom_state = 97\nn_components = 3\n\n# Ejecutar UMAP\nm_umap = uu.run_umap(\n    m_clr,\n    n_neighbors=n_neighbors,\n    min_dist=min_dist,\n    random_state=random_state,\n    n_components=n_components,\n)\n\n# Guardar resultados\ndu.save_data(m_umap, PROCESSED_DATA_DIR + \"M_umap\")\n\nm_umap.head()\n\n/home/davidnfu0/.conda/envs/Omic_Integration/lib/python3.13/site-packages/umap/umap_.py:1952: UserWarning:\n\nn_jobs value 1 overridden to 1 by setting random_state. Use no seed for parallelism.\n\n\n\n\n\n\n\n\n\n\nUMAP_1\nUMAP_2\nUMAP_3\n\n\n\n\nS10_Z00\n3.008061\n12.104615\n4.211886\n\n\nS10_Z01\n3.353623\n12.191257\n4.169571\n\n\nS10_Z05\n5.812279\n12.092410\n2.699975\n\n\nS11_Z00\n3.822574\n12.323472\n3.502521\n\n\nS11_Z01\n3.721075\n12.002115\n4.032786\n\n\n\n\n\n\n\nAnálisis visual básico de resultados UMAP\n\np.scatter_plot_3d(\n    m_umap[\"UMAP_1\"],\n    m_umap[\"UMAP_2\"],\n    m_umap[\"UMAP_3\"],\n    xlabel=\"UMAP 1\",\n    ylabel=\"UMAP 2\",\n    title=\"UMAP 3D Scatter Plot\",\n    s=40,\n    alpha=0.7,\n)\n\n\n\n\n\n\n\n\nAnálisis de relación entre UMAP y variables de metadatos\n\nnumerical_columns_metadata = metadata.select_dtypes(\n    include=[np.number]\n).columns.tolist()\nnumerical_columns_metadata.remove(\"day\")\nnumerical_columns_metadata.remove(\"hour\")\nnumerical_columns_metadata.remove(\"minute\")\nnumerical_columns_metadata.remove(\"second\")\nnumerical_columns_metadata.remove(\"year\")\nnumerical_columns_metadata.remove(\"month\")\ncolumns_metadata = numerical_columns_metadata\n\np.plot_dim_reduction_metadata(\n    m_umap[\"UMAP_1\"], m_umap[\"UMAP_2\"], metadata, columns_metadata, dim_name=\"UMAP\"\n)"
  },
  {
    "objectID": "reports/clustering_execution.html",
    "href": "reports/clustering_execution.html",
    "title": "Clustering Execution & Optimization",
    "section": "",
    "text": "Optimización de hiperparámetros y ejecución de algoritmos de clustering sobre espacios MOFA y UMAP.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport src.data_utils as du\nimport src.clustering_utils as cu\nimport src.plots as p\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nImportar datos procesados de MOFA y UMAP.\n\nDATA_DIR = \"../data/\"\n\n# Factores de MOFA\nm_factors = du.load_data(DATA_DIR + \"MOFA_dir/M_factors\", index_col=0)\n\n# Caracteristicas de UMAP\nm_umap = du.load_data(DATA_DIR + \"processed_data/M_umap\", index_col=0)"
  },
  {
    "objectID": "reports/clustering_execution.html#resumen",
    "href": "reports/clustering_execution.html#resumen",
    "title": "Clustering Execution & Optimization",
    "section": "",
    "text": "Optimización de hiperparámetros y ejecución de algoritmos de clustering sobre espacios MOFA y UMAP.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport src.data_utils as du\nimport src.clustering_utils as cu\nimport src.plots as p\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nimport numpy as np\n\nImportar datos procesados de MOFA y UMAP.\n\nDATA_DIR = \"../data/\"\n\n# Factores de MOFA\nm_factors = du.load_data(DATA_DIR + \"MOFA_dir/M_factors\", index_col=0)\n\n# Caracteristicas de UMAP\nm_umap = du.load_data(DATA_DIR + \"processed_data/M_umap\", index_col=0)"
  },
  {
    "objectID": "reports/clustering_execution.html#ejecución-de-k-means",
    "href": "reports/clustering_execution.html#ejecución-de-k-means",
    "title": "Clustering Execution & Optimization",
    "section": "Ejecución de K-Means",
    "text": "Ejecución de K-Means\n\nDatos MOFA\nSelección de Hyperparámetros óptimos\n\nmofa_kmeans_res = cu.run_kmeans_optimization(m_factors, k_range=range(2, 12))\nopt_k_mofa = mofa_kmeans_res[\"optimal_k\"]\n\nprint(f\"MOFA Optimal k detected: {opt_k_mofa}\")\n\np.plot_elbow_silhouette(\n    mofa_kmeans_res[\"k_range\"],\n    mofa_kmeans_res[\"inertias\"],\n    mofa_kmeans_res[\"silhouettes\"],\n    opt_k_mofa,\n    \"MOFA Clustering\",\n)\n\nMOFA Optimal k detected: 7\n\n\n\n\n\n\n\n\n\nMatriz de proximidad de los clusters\n\nlabels_mofa = mofa_kmeans_res[\"results\"][8][\"labels\"]\nm_factors_ordered = m_factors.copy()\nm_factors_ordered[\"Cluster\"] = labels_mofa\nm_factors_ordered = m_factors_ordered.sort_values(\"Cluster\")\n\ndist_matrix = cu.get_proximity_matrix(m_factors_ordered.drop(columns=\"Cluster\"))\n\nplt.figure(figsize=(8, 6))\nsns.heatmap(dist_matrix, cmap=\"viridis\", xticklabels=False, yticklabels=False)\nplt.title(\"Proximity Matrix (Sorted by K-Means MOFA Cluster)\")\nplt.show()\n\n\n\n\n\n\n\n\n\n\nDatos UMAP\nSelección de Hyperparámetros óptimos\n\numap_kmeans_res = cu.run_kmeans_optimization(m_umap, k_range=range(2, 12))\nopt_k_umap = umap_kmeans_res[\"optimal_k\"]\nselected_k_umap = 8\n\nprint(f\"UMAP Optimal k detected: {opt_k_umap}\")\n\np.plot_elbow_silhouette(\n    umap_kmeans_res[\"k_range\"],\n    umap_kmeans_res[\"inertias\"],\n    umap_kmeans_res[\"silhouettes\"],\n    selected_k_umap,\n    \"UMAP Clustering\",\n)\n\nUMAP Optimal k detected: 6\n\n\n\n\n\n\n\n\n\nMatriz de proximidad de los clusters\n\nlabels_umap = umap_kmeans_res[\"results\"][8][\"labels\"]\nm_umap_ordered = m_umap.copy()\nm_umap_ordered[\"Cluster\"] = labels_umap\nm_umap_ordered = m_umap_ordered.sort_values(\"Cluster\")\n\ndist_matrix = cu.get_proximity_matrix(m_umap_ordered.drop(columns=\"Cluster\"))\n\nplt.figure(figsize=(8, 6))\nsns.heatmap(dist_matrix, cmap=\"viridis\", xticklabels=False, yticklabels=False)\nplt.title(\"Proximity Matrix (Sorted by K-Means UMAP Cluster)\")\nplt.show()"
  },
  {
    "objectID": "reports/clustering_execution.html#ejecución-de-gmm",
    "href": "reports/clustering_execution.html#ejecución-de-gmm",
    "title": "Clustering Execution & Optimization",
    "section": "Ejecución de GMM",
    "text": "Ejecución de GMM\n\nDatos MOFA\nSelección de Hyperparámetros óptimos\n\ngmm_res = cu.optimize_gmm(m_factors, k_range=range(2, 12))\np.plot_gmm_optimization(\n    gmm_res[\"k_range\"], gmm_res[\"bics\"], gmm_res[\"aics\"], gmm_res[\"silhouettes\"]\n)\nbest_k_gmm = gmm_res[\"k_range\"][np.argmin(gmm_res[\"bics\"])]\nprint(f\"Best K based on BIC: {best_k_gmm}\")\n\nk_gmm_mofa = 8  # Seleccionado manualmente\nlabels_gmm_opt = gmm_res[\"results\"][k_gmm_mofa][\"labels\"]\n\n\n\n\n\n\n\n\nBest K based on BIC: 9\n\n\nMatriz de proximidad de los clusters\n\nm_factors_ordered_gmm = m_factors.copy()\nm_factors_ordered_gmm[\"Cluster\"] = labels_gmm_opt\nm_factors_ordered_gmm = m_factors_ordered_gmm.sort_values(\"Cluster\")\ndist_matrix_gmm = cu.get_proximity_matrix(\n    m_factors_ordered_gmm.drop(columns=\"Cluster\")\n)\nplt.figure(figsize=(8, 6))\nsns.heatmap(dist_matrix_gmm, cmap=\"viridis\", xticklabels=False, yticklabels=False)\nplt.title(\"Proximity Matrix (Sorted by GMM MOFA Cluster)\")\nplt.show()\n\n\n\n\n\n\n\n\n\n\nDatos UMAP\nSelección de Hyperparámetros óptimos\n\ngmm_umap_res = cu.optimize_gmm(m_umap, k_range=range(2, 12))\np.plot_gmm_optimization(\n    gmm_umap_res[\"k_range\"], gmm_umap_res[\"bics\"], gmm_umap_res[\"aics\"], gmm_umap_res[\"silhouettes\"]\n)\nbest_k_gmm_umap = gmm_umap_res[\"k_range\"][np.argmin(gmm_umap_res[\"bics\"])]\nprint(f\"Best K based on BIC: {best_k_gmm_umap}\")\nk_gmm_umap = 8  # Seleccionado manualmente\nlabels_gmm_umap_opt = gmm_umap_res[\"results\"][k_gmm_umap][\"labels\"]\n\n\n\n\n\n\n\n\nBest K based on BIC: 8\n\n\nMatriz de proximidad de los clusters\n\nm_umap_ordered_gmm = m_umap.copy()\nm_umap_ordered_gmm[\"Cluster\"] = labels_gmm_umap_opt\nm_umap_ordered_gmm = m_umap_ordered_gmm.sort_values(\"Cluster\")\ndist_matrix_gmm_umap = cu.get_proximity_matrix(\n    m_umap_ordered_gmm.drop(columns=\"Cluster\")\n)\nplt.figure(figsize=(8, 6))\nsns.heatmap(dist_matrix_gmm_umap, cmap=\"viridis\", xticklabels=False, yticklabels=False)\nplt.title(\"Proximity Matrix (Sorted by GMM UMAP Cluster)\")\nplt.show()"
  },
  {
    "objectID": "reports/clustering_execution.html#ejecución-de-dbscan",
    "href": "reports/clustering_execution.html#ejecución-de-dbscan",
    "title": "Clustering Execution & Optimization",
    "section": "Ejecución de DBSCAN",
    "text": "Ejecución de DBSCAN\n\nDatos MOFA\nSelección de Hyperparámetros óptimos\n\neps_candidates = np.arange(0.1, 2.0, 0.1)\nmin_samples_candidates = [3, 5, 10]\n\ndbscan_table = cu.grid_search_dbscan(m_factors, eps_candidates, min_samples_candidates)\n\ndbscan_table_filtered = dbscan_table[\n    (dbscan_table[\"n_clusters\"] &gt; 1) & (dbscan_table[\"noise_ratio\"] &lt; 1)\n].sort_values(\"silhouette\", ascending=False)\n\ndisplay(dbscan_table_filtered.head(10))\n\n\n\n\n\n\n\n\neps\nmin_samples\nn_clusters\nn_noise\nnoise_ratio\nsilhouette\nlabels\n\n\n\n\n39\n1.4\n3\n2\n153\n0.962\n-0.154\n[-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -...\n\n\n42\n1.5\n3\n2\n153\n0.962\n-0.154\n[-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -...\n\n\n54\n1.9\n3\n9\n120\n0.755\n-0.181\n[-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -...\n\n\n45\n1.6\n3\n4\n146\n0.918\n-0.207\n[-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -...\n\n\n48\n1.7\n3\n6\n138\n0.868\n-0.224\n[-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -...\n\n\n51\n1.8\n3\n8\n129\n0.811\n-0.237\n[-1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -...\n\n\n\n\n\n\n\n\nk_neighbors = 5\ndistances = cu.calculate_k_distance(m_factors, k=k_neighbors)\np.plot_k_distance_curve(distances, k=k_neighbors)\n\n\n\n\n\n\n\n\n\nlabels_dbscan_opt = cu.run_dbscan(m_factors, eps=4, min_samples=5)[\"labels\"]\n\nMatriz de proximidad de los clusters\n\nm_factors_ordered_dbscan = m_factors.copy()\nm_factors_ordered_dbscan[\"Cluster\"] = labels_dbscan_opt\nm_factors_ordered_dbscan = m_factors_ordered_dbscan.sort_values(\"Cluster\")\ndist_matrix_dbscan = cu.get_proximity_matrix(\n    m_factors_ordered_dbscan.drop(columns=\"Cluster\")\n)\nplt.figure(figsize=(8, 6))\nsns.heatmap(dist_matrix_dbscan, cmap=\"viridis\", xticklabels=False, yticklabels=False)\nplt.title(\"Proximity Matrix (Sorted by DBSCAN MOFA Cluster)\")\nplt.show()\n\n\n\n\n\n\n\n\n\n\nDatos UMAP\nSelección de Hyperparámetros óptimos\n\neps_candidates = np.arange(0.1, 2.0, 0.1)\nmin_samples_candidates = [3, 5, 10]\ndbscan_umap_table = cu.grid_search_dbscan(m_umap, eps_candidates, min_samples_candidates)\ndbscan_umap_table_filtered = dbscan_umap_table[\n    (dbscan_umap_table[\"n_clusters\"] &gt; 1) & (dbscan_umap_table[\"noise_ratio\"] &lt; 1)\n].sort_values(\"silhouette\", ascending=False)\ndisplay(dbscan_umap_table_filtered.head(10))\n\n\n\n\n\n\n\n\neps\nmin_samples\nn_clusters\nn_noise\nnoise_ratio\nsilhouette\nlabels\n\n\n\n\n22\n0.8\n5\n6\n0\n0.000\n0.608\n[0, 0, 1, 0, 0, 1, 1, 2, 1, 1, 2, 2, 0, 1, 1, ...\n\n\n18\n0.7\n3\n6\n0\n0.000\n0.608\n[0, 0, 1, 0, 0, 1, 1, 2, 1, 1, 2, 2, 0, 1, 1, ...\n\n\n23\n0.8\n10\n7\n1\n0.006\n0.594\n[0, 0, 2, 0, 0, 2, 2, 1, 2, 2, 1, 1, 0, 2, 3, ...\n\n\n20\n0.7\n10\n9\n8\n0.050\n0.590\n[-1, 0, 2, 0, 0, 2, 2, 1, 2, 2, 1, 1, 3, 2, 4,...\n\n\n21\n0.8\n3\n5\n0\n0.000\n0.580\n[0, 0, 1, 0, 0, 1, 1, 2, 1, 1, 2, 2, 0, 1, 1, ...\n\n\n19\n0.7\n5\n6\n1\n0.006\n0.570\n[0, 0, 1, 0, 0, 1, 1, 2, 1, 1, 2, 2, 0, 1, 1, ...\n\n\n15\n0.6\n3\n7\n0\n0.000\n0.554\n[0, 0, 1, 2, 0, 1, 1, 3, 1, 1, 3, 3, 2, 1, 1, ...\n\n\n13\n0.5\n5\n10\n7\n0.044\n0.545\n[0, 0, 1, 3, 0, 1, 1, 2, 1, -1, 2, 2, 3, 6, 4,...\n\n\n25\n0.9\n5\n5\n0\n0.000\n0.544\n[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, ...\n\n\n29\n1.0\n10\n5\n0\n0.000\n0.544\n[0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, ...\n\n\n\n\n\n\n\n\nk_neighbors = 5\ndistances_umap = cu.calculate_k_distance(m_umap, k=k_neighbors)\np.plot_k_distance_curve(distances_umap, k=k_neighbors)\n\n\n\n\n\n\n\n\n\nlabels_dbscan_umap_opt = cu.run_dbscan(m_umap, eps=0.4, min_samples=5)[\"labels\"]\n\nMatriz de proximidad de los clusters\n\nm_umap_ordered_dbscan = m_umap.copy()\nm_umap_ordered_dbscan[\"Cluster\"] = labels_dbscan_umap_opt\nm_umap_ordered_dbscan = m_umap_ordered_dbscan.sort_values(\"Cluster\")\ndist_matrix_dbscan_umap = cu.get_proximity_matrix(\n    m_umap_ordered_dbscan.drop(columns=\"Cluster\")\n)\nplt.figure(figsize=(8, 6))\nsns.heatmap(dist_matrix_dbscan_umap, cmap=\"viridis\", xticklabels=False, yticklabels=False)\nplt.title(\"Proximity Matrix (Sorted by DBSCAN UMAP Cluster)\")\nplt.show()"
  },
  {
    "objectID": "reports/clustering_execution.html#guardar-mejores-modelos-de-clustering",
    "href": "reports/clustering_execution.html#guardar-mejores-modelos-de-clustering",
    "title": "Clustering Execution & Optimization",
    "section": "Guardar mejores modelos de clustering",
    "text": "Guardar mejores modelos de clustering\n\n# OPCIONES DISPONIBLES:\n# labels_kmeans_opt / labels_umap_kmeans_opt\n# labels_gmm_opt / labels_gmm_umap_opt\n# labels_dbscan_opt / labels_dbscan_umap_opt\n\nCLUTERING_DIR = DATA_DIR + \"clustering_dir/\"\nselected_models = {\n    \"GMM_Opt\": labels_gmm_opt,\n    \"GMM_UMAP_Opt\": labels_gmm_umap_opt,\n}\nfor model_name, labels in selected_models.items():\n    df_selected = pd.DataFrame(labels, index=m_factors.index, columns=[\"Cluster\"])\n    du.save_data(df_selected, CLUTERING_DIR + f\"selected_clusters_{model_name}\")"
  },
  {
    "objectID": "reports/pareto_analysis.html",
    "href": "reports/pareto_analysis.html",
    "title": "Pareto Task Inference Analysis",
    "section": "",
    "text": "Aplicación del método Pareto TI para identificar arquetipos biológicos y sus tareas asociadas dentro del espacio latente generado por MOFA. Se basa en la teoría de que los fenotipos óptimos bajo trade-offs forman politopos en el espacio de características.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.pareto_utils as pu\nimport src.plots as p\n\nImportar datos procesados de MOFA y metadata.\n\nDATA_DIR = \"../data/\"\nm_factors = du.load_data(DATA_DIR + \"MOFA_dir/M_factors\", index_col=0)\nmetadata = du.load_data(\n    DATA_DIR + \"processed_metadata/Metadata_aggregated\", index_col=0\n)\n\nX = np.float32(m_factors.iloc[:, :3].values)\nprint(f\"Input shape: {X.shape}\")\n\nInput shape: (159, 3)\n\n\nDeterminar arquetipos usando Pareto TI\n\nresults_k_list = []\nfor k in range(2, 7):\n    res_k = pu.fit_pcha_partipy(X, k=k, max_iter=500, tol=1e-4, delta=0.0)\n    results_k_list.append(\n        {\"k\": k, \"ev\": res_k[\"explained_variance\"], \"t_ratio\": res_k[\"t_ratio\"]}\n    )\n\nresults_k_df = pd.DataFrame(results_k_list)\ndisplay(results_k_df)\np.plot_pareto_ev_curve(results_k_list)\n\n\n\n\n\n\n\n\nk\nev\nt_ratio\n\n\n\n\n0\n2\n0.499948\nNaN\n\n\n1\n3\n0.867740\nNaN\n\n\n2\n4\n0.955854\n0.238491\n\n\n3\n5\n0.968278\n0.406006\n\n\n4\n6\n0.989191\n0.603774\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBEST_K = 4\nprint(f\"BEST_K seleccionado: {BEST_K}\")\n\nBEST_K seleccionado: 4\n\n\nAjuste del modelo final\n\nres_final = pu.fit_pcha_partipy(\n    X,\n    k=BEST_K,\n    max_iter=1000,\n    tol=1e-4,\n    delta=0.4,\n)\n\narchetypes = res_final[\"archetypes\"]\nS_matrix = res_final[\"S_matrix\"]\n\nprint(\"Varianza explicada:\", res_final[\"explained_variance\"])\nprint(\"t-ratio:\", res_final[\"t_ratio\"])\n\nVarianza explicada: 0.9872636\nt-ratio: 0.609558142378639\n\n\nVisualización del politopo\n\np.plot_polytope_3d(X, archetypes, labels=None, title=f\"Politopo de Pareto (k={BEST_K})\")\n\n/home/davidnfu0/Drive/SB/2-Universidad/10-DecimoSemestre/LabModelamiento/Código/src/plots.py:616: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n\n\n\n\n\n\n\n\n\nAnálisis de tareas asociadas a arquetipos\n\nif \"oxygen_[ml/l]\" in metadata.columns:\n    enrich_ox = pu.calculate_enrichment(X, archetypes, metadata, \"oxygen_[ml/l]\")\n    p.plot_enrichment_curves(enrich_ox)\n    display(enrich_ox[[\"archetype\", \"p_value\", \"max_enrichment\"]])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\narchetype\np_value\nmax_enrichment\n\n\n\n\n0\n1\n0.045337\n1.245092\n\n\n1\n2\n0.987595\n0.703628\n\n\n2\n3\n0.514843\n0.956513\n\n\n3\n4\n0.149366\n1.125055\n\n\n\n\n\n\n\n\nif \"nitrates_[um]\" in metadata.columns:\n    enrich_nit = pu.calculate_enrichment(X, archetypes, metadata, \"nitrates_[um]\")\n    p.plot_enrichment_curves(enrich_nit)\n    display(enrich_nit[[\"archetype\", \"p_value\", \"max_enrichment\"]])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\narchetype\np_value\nmax_enrichment\n\n\n\n\n0\n1\n0.379685\n1.041554\n\n\n1\n2\n0.046163\n1.202284\n\n\n2\n3\n0.390629\n1.012616\n\n\n3\n4\n0.955744\n0.778816\n\n\n\n\n\n\n\n\nif \"temperature_[c]\" in metadata.columns:\n    enrich_temp = pu.calculate_enrichment(X, archetypes, metadata, \"temperature_[c]\")\n    p.plot_enrichment_curves(enrich_temp)\n    display(enrich_temp[[\"archetype\", \"p_value\", \"max_enrichment\"]])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\narchetype\np_value\nmax_enrichment\n\n\n\n\n0\n1\n0.593905\n0.952220\n\n\n1\n2\n0.324495\n0.994534\n\n\n2\n3\n0.217251\n1.050654\n\n\n3\n4\n0.003848\n1.163966"
  },
  {
    "objectID": "reports/pareto_analysis.html#resumen",
    "href": "reports/pareto_analysis.html#resumen",
    "title": "Pareto Task Inference Analysis",
    "section": "",
    "text": "Aplicación del método Pareto TI para identificar arquetipos biológicos y sus tareas asociadas dentro del espacio latente generado por MOFA. Se basa en la teoría de que los fenotipos óptimos bajo trade-offs forman politopos en el espacio de características.\nAñadir al sistema al ruta al directorio base para importar módulos personalizados.\n\nimport sys, os\nsys.path.append(os.path.abspath(\"..\"))\n\nImportar librerías y módulos necesarios.\n\nimport pandas as pd\nimport numpy as np\nimport src.data_utils as du\nimport src.pareto_utils as pu\nimport src.plots as p\n\nImportar datos procesados de MOFA y metadata.\n\nDATA_DIR = \"../data/\"\nm_factors = du.load_data(DATA_DIR + \"MOFA_dir/M_factors\", index_col=0)\nmetadata = du.load_data(\n    DATA_DIR + \"processed_metadata/Metadata_aggregated\", index_col=0\n)\n\nX = np.float32(m_factors.iloc[:, :3].values)\nprint(f\"Input shape: {X.shape}\")\n\nInput shape: (159, 3)\n\n\nDeterminar arquetipos usando Pareto TI\n\nresults_k_list = []\nfor k in range(2, 7):\n    res_k = pu.fit_pcha_partipy(X, k=k, max_iter=500, tol=1e-4, delta=0.0)\n    results_k_list.append(\n        {\"k\": k, \"ev\": res_k[\"explained_variance\"], \"t_ratio\": res_k[\"t_ratio\"]}\n    )\n\nresults_k_df = pd.DataFrame(results_k_list)\ndisplay(results_k_df)\np.plot_pareto_ev_curve(results_k_list)\n\n\n\n\n\n\n\n\nk\nev\nt_ratio\n\n\n\n\n0\n2\n0.499948\nNaN\n\n\n1\n3\n0.867740\nNaN\n\n\n2\n4\n0.955854\n0.238491\n\n\n3\n5\n0.968278\n0.406006\n\n\n4\n6\n0.989191\n0.603774\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nBEST_K = 4\nprint(f\"BEST_K seleccionado: {BEST_K}\")\n\nBEST_K seleccionado: 4\n\n\nAjuste del modelo final\n\nres_final = pu.fit_pcha_partipy(\n    X,\n    k=BEST_K,\n    max_iter=1000,\n    tol=1e-4,\n    delta=0.4,\n)\n\narchetypes = res_final[\"archetypes\"]\nS_matrix = res_final[\"S_matrix\"]\n\nprint(\"Varianza explicada:\", res_final[\"explained_variance\"])\nprint(\"t-ratio:\", res_final[\"t_ratio\"])\n\nVarianza explicada: 0.9872636\nt-ratio: 0.609558142378639\n\n\nVisualización del politopo\n\np.plot_polytope_3d(X, archetypes, labels=None, title=f\"Politopo de Pareto (k={BEST_K})\")\n\n/home/davidnfu0/Drive/SB/2-Universidad/10-DecimoSemestre/LabModelamiento/Código/src/plots.py:616: UserWarning: No data for colormapping provided via 'c'. Parameters 'cmap' will be ignored\n\n\n\n\n\n\n\n\n\nAnálisis de tareas asociadas a arquetipos\n\nif \"oxygen_[ml/l]\" in metadata.columns:\n    enrich_ox = pu.calculate_enrichment(X, archetypes, metadata, \"oxygen_[ml/l]\")\n    p.plot_enrichment_curves(enrich_ox)\n    display(enrich_ox[[\"archetype\", \"p_value\", \"max_enrichment\"]])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\narchetype\np_value\nmax_enrichment\n\n\n\n\n0\n1\n0.045337\n1.245092\n\n\n1\n2\n0.987595\n0.703628\n\n\n2\n3\n0.514843\n0.956513\n\n\n3\n4\n0.149366\n1.125055\n\n\n\n\n\n\n\n\nif \"nitrates_[um]\" in metadata.columns:\n    enrich_nit = pu.calculate_enrichment(X, archetypes, metadata, \"nitrates_[um]\")\n    p.plot_enrichment_curves(enrich_nit)\n    display(enrich_nit[[\"archetype\", \"p_value\", \"max_enrichment\"]])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\narchetype\np_value\nmax_enrichment\n\n\n\n\n0\n1\n0.379685\n1.041554\n\n\n1\n2\n0.046163\n1.202284\n\n\n2\n3\n0.390629\n1.012616\n\n\n3\n4\n0.955744\n0.778816\n\n\n\n\n\n\n\n\nif \"temperature_[c]\" in metadata.columns:\n    enrich_temp = pu.calculate_enrichment(X, archetypes, metadata, \"temperature_[c]\")\n    p.plot_enrichment_curves(enrich_temp)\n    display(enrich_temp[[\"archetype\", \"p_value\", \"max_enrichment\"]])\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\narchetype\np_value\nmax_enrichment\n\n\n\n\n0\n1\n0.593905\n0.952220\n\n\n1\n2\n0.324495\n0.994534\n\n\n2\n3\n0.217251\n1.050654\n\n\n3\n4\n0.003848\n1.163966"
  }
]